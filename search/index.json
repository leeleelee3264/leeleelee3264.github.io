[{"content":"\nCAì™€ CAì—ì„œ Digital Certificateì„ ë°œê¸‰ë°›ì•„ì„œ ì ìš©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…í•œë‹¤.\nIndex\nCA CAì—ì„œ ì¸ì¦ì„œ ìƒì„±í•˜ê¸° ì¸ì¦ì„œ ì ìš©í•˜ê¸° Chain of Trust (plus) ì¸ì¦ì„œê°€ ì‚¬ìš©ë˜ëŠ” í”„ë¡œì„¸ìŠ¤ ëª¨ì‹ë„ CA CAëŠ” ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ê¸°ê´€ì— ì˜í•´ ìš´ì˜ë˜ëŠ”ë°, ì£¼ìš” ì—…ë¬´ëŠ” ê³µê°œí‚¤ ë“±ë¡ ì‹œ ë³¸ì¸ ì¸ì¦ê³¼ X.509ì™€ ê°™ì€ ë””ì§€í„¸ ì¸ì¦ì„œ ìƒì„± ë° ë°œìƒ ë“±ì´ ìˆë‹¤.\nCAì˜ í•„ìš”ì„± ê³µê°œí‚¤ì™€ ë¹„ë°€í‚¤ë§Œì„ ì´ìš©í•´ ì•”í˜¸í™”ëŠ” ìˆ˜í–‰í•˜ë©´ ë³´ì•ˆì— ë§¤ìš° ì·¨ì•½í•´ì§„ë‹¤. [Picture 1] ì—ì„œ í•´ì»¤ê°€ ì‚¬ìš©ì Bì—ê²Œ í•´ì»¤ì˜ ê³µê°œí‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ë³´ë‚¼ ê²½ìš° ì‚¬ìš©ì BëŠ” ì‚¬ìš©ì Aê°€ ë³´ë‚¸ ë°ì´í„°ë¼ì°©ê°í•  ìˆ˜ ìˆë‹¤. ì´ì™€ ê°™ì€ í•´ì»¤ì˜ ê³µê²© ë°©ì‹ì„ MTM(Man in the Middle Attack)ì´ë¼ê³  í•œë‹¤. ì´ì™€ ê°™ì€ ì·¨ì•½ì ì„ í•´ê²°í•˜ê¸° ìœ„í•´ CA(Certificate Authority) ë¼ëŠ” ì¸ì¦ ë…¸ë“œë¥¼ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.\n[Picture 1] Man in Middle Attack\nPKIì—ì„œ CAê°€ ì‚¬ìš©ë˜ëŠ” ê³¼ì • ì‚¬ìš©ì Aê°€ ìì‹ ì˜ ê³µê°œí‚¤ë¥¼ CAì— ë“±ë¡í•œë‹¤. (ë³¸ì¸ ì¸ì¦ì„ ê±°ì¹œë‹¤) ì‚¬ìš©ì Bê°€ ì‚¬ìš©ì Aì˜ ê³µê°œí‚¤ê°€ í•„ìš”í•  ê²½ìš° CAì— ê°€ì„œ ì‚¬ìš©ì Aì˜ ê³µê°œí‚¤ë¥¼ ìš”ì²­í•œë‹¤. CAëŠ” ì‚¬ìš©ì Aì˜ ê³µê°œí‚¤ë¥¼ ì•”í™”í™”í•˜ì—¬ ì‚¬ìš©ì Bì—ê²Œ ì „ë‹¬í•œë‹¤. ì‚¬ìš©ì BëŠ” í•´ë‹¹ ê³µê°œí‚¤ë§Œì„ ì‚¬ìš©ì Aì˜ ê³µê°œí‚¤ë¼ê³  ë¯¿ê²Œ ëœë‹¤. [Picture 2] PKIì—ì„œ CAê°€ ì‚¬ìš©ë˜ëŠ” ê³¼ì •\nCA ì—…ì²´ ìœ ëª…í•œ CAë“¤ì€ [Picture 3] ê°™ë‹¤. CAì˜ ì¸ì¦ì„œë¥¼ ëŒ€ë¦¬ êµ¬ë§¤í•´ì£¼ëŠ” ì„œë¹„ìŠ¤ë“¤ì´ ì™¸êµ­ì—ë„, í•œêµ­ì—ë„ ìˆì§€ë§Œ ì§ì ‘ CAì— ê°€ì„œ ì‚¬ëŠ” ê²ƒì´ ë” ì¢‹ë‹¤. CAì— ì§ì ‘ ê°€ì„œ êµ¬ë§¤í–ˆì„ ë•Œ QnAë‚˜ ëŒ€ì‘ë„ ë” ë¹ ë¥´ê³ , ìì„¸í•˜ë©° ë‚˜ì¤‘ì— ì¸ì¦ì„œë¥¼ ê´€ë¦¬í•  ë•Œì—ë„ ë” í¸í–ˆë‹¤.\n[Picture 3] ìœ ëª…í•œ CA\nCAì—ì„œ ì¸ì¦ì„œ ìƒì„±í•˜ê¸° CAì—ì„œ ì¸ì¦ì„œë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ì„œëŠ” SANê³¼ CSRì„ ì œì¶œí•´ì•¼ í•œë‹¤. CA ì—…ì²´ì— ë”°ë¼ì„œ ì¶”ê°€ ì„œë¥˜ë¥¼ ì œì¶œí•´ì•¼ í•  ìˆ˜ ìˆìœ¼ë‹ˆ ë°œê¸‰ ì „ì— í™•ì¸í•´ì•¼ í•œë‹¤.\nSAN Subject Alternative Name ì˜ ì•½ìì´ë‹¤. Optional ì´ê³ , ì„ íƒí•œ ì¸ì¦ì„œì˜ ê°€ê²©ì— ë”°ë¼ì„œ ë³´ì¥í•˜ëŠ” SANì˜ ê°œìˆ˜ì—ë„ ì°¨ì´ê°€ ìˆë‹¤. í•˜ë‚˜ì˜ ì¸ì¦ì„œë¡œ ì—¬ëŸ¬ê°œì˜ FQDN (Fully Qualified Domain Name)ë¥¼ ë³´ì¥í•  ìˆ˜ ìˆë‹¤. í•˜ë‚˜ì˜ IPë¡œ í–¥í–ëŠ” ë„ë©”ì¸ì´ ì—¬ëŸ¬ê°œê°€ ìˆì„ ë•Œ ìì£¼ ì‚¬ìš©ì´ ëœë‹¤. SAN ì˜ˆì‹œ\nwww.digicert.com knowledge.digicert.com www.thawte.com CSR Certificate signing request ì˜ ì•½ìì´ë‹¤. CAì—ì„œ certificate ë°œê¸‰ë°›ê¸° ìœ„í•´ ë³´ë‚´ëŠ” ë©”ì„¸ì§€ì´ë‹¤. ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ” í¬ë§·ì€ PKCS #10ì´ë‹¤. CSR ì„ ë§Œë“¤ê¸° ì „ì— PrivateKeyë¥¼ ë§Œë“œëŠ”ë°, ì´ PrivateKeyê°€ ë°”ë¡œ PKIì—ì„œ ì‚¬ìš©ë˜ëŠ” ê·¸ PrivateKeyë¡œ ì•„ë¬´í•œí…Œë„ ë…¸ì¶œí•˜ë©´ ì•ˆëœë‹¤. [gogetssl] ì²˜ëŸ¼ ì¸ì¦ì„œ ì¤‘ê°„ ìœ í†µ ì—…ì²´ë“¤ì´ ë•Œë•Œë¡œ CSRê³¼ PrivateKeyë¥¼ ì‚¬ìš©ìì—ê²Œ ì£¼ê¸°ë„ í•œë‹¤. OpenSSLë¡œ CSR ìƒì„±í•˜ê¸° openssl req -new -newkey rsa:2048 -sha256 -nodes -keyout server.key -out server.csr Private keyì„ ìƒì„±í•œë‹¤. ìƒì„±í•œ Private keyë¥¼ ì‚¬ìš©í•˜ì—¬ CSRì„ ìƒì„±í•œë‹¤. CSRì„ ìƒì„±í•  ë•Œ [Picture 4] ì— ëŒ€í•œ ì •ë³´ë¥¼ ì…ë ¥í•´ì•¼ í•œë‹¤. [Picture 4] CSR ì…ë ¥ ì‚¬í•­\nCommon Name SANì´ ë‚˜ì˜¤ê³  ë‚˜ì„œë¶€í„° Common Nameì€ ì‹¤ì œì ì¸ íš¨ë ¥ ë³´ë‹¤ëŠ” ê³¼ê±°ì˜ ë ˆê±°ì‹œ í˜•íƒœë¡œ ë‚¨ì•„ìˆë‹¤. ì´ë²ˆì—ë„ CSRì„ ì‘ì„±í•  ë•Œ OVë¥¼ ë§Œë“¤ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— Common Nameì— ë„ë©”ì¸ì„ ì“°ì§€ ì•Šê³  íšŒì‚¬ ì´ë¦„ì„ ë„£ì—ˆë‹¤. Comman Nameì— ë„ë©”ì¸ì„ ë„£ëŠ”ë‹¤ë©´ ì¸ì¦ì„œê°€ ì„¤ì¹˜ë˜ëŠ” ì„œë²„ì˜ ì´ë¦„ê³¼ ì •í™•í•˜ê²Œ ë§¤ì¹˜í•´ì•¼ í•œë‹¤. ë§Œì•½ ì„œë¸Œ ë„ë©”ì¸ì„ ìœ„í•´ ì¸ì¦ì„œë¥¼ ë°œê¸‰í–ˆì„ ê²½ìš°ì—ëŠ” full ì„œë¸Œë„ë©”ì¸ì„ ì •í™•í•˜ê²Œ ëª…ì‹œí•´ì¤˜ì•¼í•œë‹¤.\nCommon Name ì˜ˆì‹œ\në„ë©”ì¸: mydomain.com ì„œë¸Œ ë„ë©”ì¸: www common name: www.domain.com Common Name vs SAN common nameì€ ë‹¨ í•˜ë‚˜ì˜ ì—”íŠ¸ë¦¬ë§Œ ì…ë ¥ì„ í•  ìˆ˜ ìˆë‹¤. wildcard ë˜ëŠ” non-wildcard ì´ë¼ë„ ë‹¨ í•˜ë‚˜ë§Œ ì…ë ¥ì„ í• ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì€ ë³€í•¨ì´ ì—†ë‹¤ SANì€ common nameì˜ ì´ëŸ° ì œì•½ì„ ì—†ì• ê¸° ìœ„í•´ ìƒê²¨ë‚¬ë‹¤. SANì´ ìˆê¸° ë•Œë¬¸ì— multi-name SSL ì¸ì¦ì„œë¥¼ ë§Œë“¤ ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤. SANì—ëŠ” ì—¬ëŸ¬ê°€ì§€ ê°’ì„ ë„£ì„ ìˆ˜ ìˆê³ , Common Nameê³¼ ì¤‘ë³µë„ ê°€ëŠ¥í•˜ë‹¤. SANì´ ì„œë²„ ë„¤ì„ì´ ì¼ì¹˜í•˜ëŠ” ê°€ í™•ì¸í•˜ê¸° ìœ„í•œ ìœ ì¼í•œ í•„ìˆ˜ ë ˆí¼ëŸ°ìŠ¤ê°€ ë˜ì—ˆë‹¤. ì¸ì¦ì„œ ê´€ë ¨ ì»¤ë§¨ë“œ ì›¹ì‚¬ì´íŠ¸ì—ì„œ ì‚¬ìš©í•˜ê³  ìˆëŠ” ì¸ì¦ì„œ ê°€ì ¸ì˜¤ê¸° echo | openssl s_client -servername google.com -connect google.com:443 |\\\\n sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' \u0026gt; certificate.crt ì¸ì¦ì„œ ì—´ì–´ë³´ê¸° openssl x509 -in certificate.crt -noout -text [íŒŒì‹± ê²°ê³¼ ì˜ˆì‹œ] Certificate: Data: Version: 3 (0x2) Serial Number: 59:43:1c:7c:0e:b1:5c:49:0a:01:4e:60:34:b8:2c:b2 Signature Algorithm: sha256WithRSAEncryption Issuer: C=US, O=Google Trust Services LLC, CN=GTS CA 1C3 Validity Not Before: Apr 25 08:31:18 2022 GMT Not After : Jul 18 08:31:17 2022 GMT Subject: CN=*.google.com Subject Public Key Info: Public Key Algorithm: id-ecPublicKey Public-Key: (256 bit) pub: 04:81:63ğŸ†d3:29:a2:15:6c:ee:b7:43:66:55:c5: 88:6e:70:9b:4d:43:40:66:ea:a4:fc:c0:06:8b:4c: fd:60:23:5f:f7:a0:e4:3c:5a:af:7f:e5:36:63:88: 55:dd:e2:60:41:6c:a1:27:3d:48:fb:2e:6a:21:6d: 01:aa:2e:25:7e ASN1 OID: prime256v1 NIST CURVE: P-256 X509v3 extensions: X509v3 Key Usage: critical Digital Signature X509v3 Extended Key Usage: TLS Web Server Authentication X509v3 Basic Constraints: critical CA:FALSE X509v3 Subject Key Identifier: 8B:09:31:88:DD:30:A6:59:D3:86:E5:3D:EA:06:6D:F3:C0:25:96:D5 X509v3 Authority Key Identifier: keyid:8A:74:7F:AF:85:CD:EE:95:CD:3D:9C:D0:E2:46:14:F3:71:35:1D:27 Authority Information Access: OCSP - URI:http://ocsp.pki.goog/gts1c3 CA Issuers - URI:http://pki.goog/repo/certs/gts1c3.der X509v3 Subject Alternative Name: DNS:*.google.com, DNS:*.appengine.google.com, DNS:*.bdn.dev, DNS:*.cloud.google.com, DNS:*.crowdsource.google.com, DNS:*.datacompute.google.com, DNS:*.google.ca, DNS:*.google.cl, DNS:*.google.co.in, DNS:*.google.co.jp, DNS:*.google.co.uk, DNS:*.google.com.ar, DNS:*.google.com.au, DNS:*.google.com.br, DNS:*.google.com.co, DNS:*.google.com.mx, DNS:*.google.com.tr, DNS:*.google.com.vn, DNS:*.google.de, DNS:*.google.es, DNS:*.google.fr, DNS:*.google.hu, DNS:*.google.it, DNS:*.google.nl, DNS:*.google.pl, DNS:*.google.pt, DNS:*.googleadapis.com, DNS:*.googleapis.cn, DNS:*.googlevideo.com, DNS:*.gstatic.cn, DNS:*.gstatic-cn.com, DNS:googlecnapps.cn, DNS:*.googlecnapps.cn, DNS:googleapps-cn.com, DNS:*.googleapps-cn.com, DNS:gkecnapps.cn, DNS:*.gkecnapps.cn, DNS:googledownloads.cn, DNS:*.googledownloads.cn, DNS:recaptcha.net.cn, DNS:*.recaptcha.net.cn, DNS:recaptcha-cn.net, DNS:*.recaptcha-cn.net, DNS:widevine.cn, DNS:*.widevine.cn, DNS:ampproject.org.cn, DNS:*.ampproject.org.cn, DNS:ampproject.net.cn, DNS:*.ampproject.net.cn, DNS:google-analytics-cn.com, DNS:*.google-analytics-cn.com, DNS:googleadservices-cn.com, DNS:*.googleadservices-cn.com, DNS:googlevads-cn.com, DNS:*.googlevads-cn.com, DNS:googleapis-cn.com, DNS:*.googleapis-cn.com, DNS:googleoptimize-cn.com, DNS:*.googleoptimize-cn.com, DNS:doubleclick-cn.net, DNS:*.doubleclick-cn.net, DNS:*.fls.doubleclick-cn.net, DNS:*.g.doubleclick-cn.net, DNS:doubleclick.cn, DNS:*.doubleclick.cn, DNS:*.fls.doubleclick.cn, DNS:*.g.doubleclick.cn, DNS:dartsearch-cn.net, DNS:*.dartsearch-cn.net, DNS:googletraveladservices-cn.com, DNS:*.googletraveladservices-cn.com, DNS:googletagservices-cn.com, DNS:*.googletagservices-cn.com, DNS:googletagmanager-cn.com, DNS:*.googletagmanager-cn.com, DNS:googlesyndication-cn.com, DNS:*.googlesyndication-cn.com, DNS:*.safeframe.googlesyndication-cn.com, DNS:app-measurement-cn.com, DNS:*.app-measurement-cn.com, DNS:gvt1-cn.com, DNS:*.gvt1-cn.com, DNS:gvt2-cn.com, DNS:*.gvt2-cn.com, DNS:2mdn-cn.net, DNS:*.2mdn-cn.net, DNS:googleflights-cn.net, DNS:*.googleflights-cn.net, DNS:admob-cn.com, DNS:*.admob-cn.com, DNS:*.gstatic.com, DNS:*.metric.gstatic.com, DNS:*.gvt1.com, DNS:*.gcpcdn.gvt1.com, DNS:*.gvt2.com, DNS:*.gcp.gvt2.com, DNS:*.url.google.com, DNS:*.youtube-nocookie.com, DNS:*.ytimg.com, DNS:android.com, DNS:*.android.com, DNS:*.flash.android.com, DNS:g.cn, DNS:*.g.cn, DNS:g.co, DNS:*.g.co, DNS:goo.gl, DNS:www.goo.gl, DNS:google-analytics.com, DNS:*.google-analytics.com, DNS:google.com, DNS:googlecommerce.com, DNS:*.googlecommerce.com, DNS:ggpht.cn, DNS:*.ggpht.cn, DNS:urchin.com, DNS:*.urchin.com, DNS:youtu.be, DNS:youtube.com, DNS:*.youtube.com, DNS:youtubeeducation.com, DNS:*.youtubeeducation.com, DNS:youtubekids.com, DNS:*.youtubekids.com, DNS:yt.be, DNS:*.yt.be, DNS:android.clients.google.com, DNS:developer.android.google.cn, DNS:developers.android.google.cn, DNS:source.android.google.cn X509v3 Certificate Policies: Policy: 2.23.140.1.2.1 Policy: 1.3.6.1.4.1.11129.2.5.3 X509v3 CRL Distribution Points: Full Name: URI:http://crls.pki.goog/gts1c3/QOvJ0N1sT2A.crl 1.3.6.1.4.1.11129.2.4.2: ......v.)y...99!.Vs.c.w..W}.` ..M]\u0026amp;\\%]......`........G0E.!......Y.Z...Z.s#...Al...\u0026amp;......Wi. m.-a..._^,...#....D.tZ.j..W.g....w...^.h.O.l..._N\u0026gt;Z.....j^.;.. D\\*s....`..!.....H0F.!..6:.?...f..m.}%.r..........E.....!..U....G...%.$D.mG.B.. Signature Algorithm: sha256WithRSAEncryption 5c:2b:62:ec:f6:ee:92:0c:28:98:92:af:35:f0:78:5b:75:f2: a2:c5:e9:56:04:da:31:ed:0c:92:16:3a:14:47:f9:60:7d:e4: 36:33:82:13:68:54:37:47:81:f8:b6:0e:66:a7:87:c4:f5:82: ca:58:62:a2:15:63:16:28:5b:8e:bc:e7:18:af:97:a2:f4:92: 92:e3:2f:69:df:ba:7a:80:92:20:14:22:4f:3d:26:69:c6:f8: 90:d1:2c:36:57:0a:5c:20:00:86:d2:bd:52:db:19:39:46:12: b0:65:1d:16:3d:f1:58:4b:d6:19:c0:4b:0d:eb:ad:0b:b9:1c: 03:ad:cb:d1:04:33:a2:2c:b8:33:f6:01:7c:71:7f:e8:8a:32: c1:74:9a:11:f7ğŸ†b9:ff:f8:89:99:f3:f9:50:7b:31:c7:fa: fc:71:d1:c6:f2:b4:d2:82:93:84:ae:d8:eb:55:41:d4:de:9d: 7f:47:44:05:4a:fb:a7:09:b2:89:99:a7:7f:64:13:52:be:73: ee:00:b9:1c:ad:e1:44:48:41:a4:77:55:8d:0a:c8:b0:bb:69: fe:9a:84:a5:cd:2d:a9:61:3b:60:92:e4:43:d6:2b:79:d6:5a: 0d:db:f7:7f:7a:fc:7d:c3:59:e3:7d:d7:47:78:c2:b2:7d:6d: f2:7a:75:49 ê°„ë‹¨í•˜ê²Œ ì¸ì¦ì„œ ì¡°íšŒë¥¼ í•˜ê¸° ìœ„í•´ì„œëŠ” online parserë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. [Online Parser] íŒŒì‹±ì˜ ê²°ê³¼ë¡œ ë‚˜ì˜¨ fieldì— ëŒ€í•œ ì„¤ëª…ì€ [LeeLee- Digital Certificate] í¬ìŠ¤íŠ¸ ì—ì„œ ë” ìì„¸í•˜ê²Œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.\nì¸ì¦ì„œ ì ìš©í•˜ê¸° CA bundle CAì—ì„œ ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ìœ¼ë©´ end-entity (ë‚´ application)ì˜ ì¸ì¦ì„œë§Œ ì˜¤ì§€ ì•ŠëŠ”ë‹¤. Root CAì˜ ì¸ì¦ì„œì™€ Intermediate ì¸ì¦ì„œê°€ í•¨ê»˜ ì˜¤ëŠ”ë° ì´ë¥¼ CA bundleì´ë¼ê³  í•œë‹¤. CA bundleì€ ì›¹ ë¸Œë¼ìš°ì € ë“±ì˜ í´ë¼ì´ì–¸íŠ¸ì™€ ì¸ì¦ì„œì˜ í˜¸ì™„ì„±ì„ ë†’íˆê¸° ìœ„í•´ì„œ ì‚¬ìš©ì´ ëœë‹¤.\nCA bundle ì˜ˆì‹œ\nRoot CA ì¸ì¦ì„œ + Intermediate ì¸ì¦ì„œ + end-entity ì¸ì¦ì„œ = Certificate Chain [Picture 5] CA bundle\nCA bundleì€ *.ca-bundle í™•ì¥ìì˜ zip íŒŒì¼ì´ë‚˜ root, intermediate ê°œë³„ë¡œ ì£¼ì–´ì§„ë‹¤. CA bundleì€ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ìˆœì°¨ì ìœ¼ë¡œ ì œê³µì´ ë˜ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ëŒ€ê²ŒëŠ” CAì—ì„œ ì´ë¯¸ í•˜ë‚˜ì˜ bundleì„ ë§Œë“¤ì–´ì„œ ì œê³µí•´ì¤€ë‹¤. ë§Œì•½ ê°œë³„ë¡œ ì£¼ì–´ì¡Œì„ ê²½ìš°ì—ëŠ” í•˜ë‚˜ì˜ ca-bundleë¡œ í•©ì³ì•¼ í•œë‹¤\nCA bundle í•©ì¹˜ê¸° ì˜ˆì‹œ\nAddTrustExternalCARoot.crtÂ â€“\u0026gt; Root CA Certificate COMODORSAAddTrustCA.crtÂ â€“\u0026gt; Intermediate CA Certificate 1 COMODORSADomainValidationSecureServerCA.crtÂ â€“\u0026gt; Intermediate CA Certificate 2 yourDomain.crtÂ â€“\u0026gt; Your SSL Certificate cat ComodoRSADomainValidationSecureServerCA.crt ComodoRSAAddTrustCA.crt AddTrustExternalCARoot.crt \u0026gt; yourDomain.ca-bundle Google CA Bundle ì˜ˆì‹œ\në¸Œë¼ìš°ì €ì˜ ë¸Œë¼ìš°ì§• ì°½ì— ğŸ”’ ëª¨ì–‘ì„ ëˆ„ë¥´ë©´ í•´ë‹¹ ë„ë©”ì¸ì— ëŒ€í•œ ì¸ì¦ì„œì˜ ì¢…ë¥˜, ìƒíƒœ ë“±ì„ ë³¼ ìˆ˜ ìˆëŠ”ë° google.comì˜ ì¸ì¦ì„œë¥¼ ì—´ì–´ë´¤ì„ ë•Œì—ë„ ì•„ë˜ì²˜ëŸ¼ ì¸ì¦ì„œê°€ ê³„ì¸µì„ ì´ë£¨ê³  ìˆë‹¤.\nend-entity ì¸ì¦ì„œ: *.google.com Intermediate ì¸ì¦ì„œ: GTS CA 1C3 Root ì¸ì¦ì„œ: GTS Root R1 [Picture 6] End Entity Certificate\n[Picture 7] Intermediate Certificate\n[Picture 8] Root Certificate\nApply CA Bundle CA bundleì„ ì„œë²„ í˜¸ìŠ¤íŠ¸ ì–´ë””ì—”ê°€ ë‹¤ìš´ë¡œë“œí•´ë‘ì—ˆë‹¤ë©´ í•´ë‹¹ ë„ë©”ì¸ì´ ë“±ë¡ë˜ì–´ìˆëŠ” Nginx ë“±ì˜ ì›¹ì„œë²„ì— CA Bundleê°€ ìˆëŠ” pathë¥¼ ì ì–´ì£¼ë©´ ëœë‹¤. ê·¸ëŸ¼ ì•Œì•„ì„œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ CA Bundleì„ í•œêº¼ë²ˆì— ë„˜ê²¨ì¤€ë‹¤. í´ë¼ì´ì–¸íŠ¸ëŠ” ì´ Bundleì„ í†µí•´ì„œ end-entityê°€ ë¯¿ì„ ìˆ˜ ìˆëŠ”ì§€ ì—†ëŠ”ì§€ ì—¬ë¶€ë¥¼ ê²°ì •í•œë‹¤. ì´ì™€ ê°™ì€ ê³¼ì •ì„ Chain of Trustë¼ê³  í•œë‹¤.\nì¸ì¦ì„œë¥¼ ì„œë²„ì— ë‹¤ìš´ë¡œë“œ í•˜ëŠ” ê²ƒì„ â€˜installedâ€™ í•œë‹¤ê³  í‘œí˜„í•˜ëŠ”ë° ì‹¤ì œë¡œëŠ” ì¸ì¦ì„œë¥¼ ì„œë²„ì— ì„¤ì¹˜í•œë‹¤ê¸° ë³´ë‹¤ëŠ” íŠ¹ì • ë””ë ‰í„°ë¦¬ì— ë„£ì–´ë‘”ë‹¤.\nLetâ€™s encrypt ë¥¼ ì¸ì¦ì„œë¡œ ì‚¬ìš©í–ˆì„ ë•Œ Nginxì˜ configuration ì˜ˆì‹œ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 server { root /var/www/html; index index.html index.htm index.nginx-debian.html; server_name www.test.me test.me; location / { try_files $uri $uri/ =404; } listen [::]:443 ssl http2; # managed by Certbot listen 443 ssl http2; # managed by Certbot ssl_certificate /etc/letsencrypt/live/test.me/fullchain.pem; # managed by Certbot ssl_certificate_key /etc/letsencrypt/live/test.me/privkey.pem; # managed by Certbot include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot } 14ë²ˆ ì¤„ì˜ ì˜ fullchain.pemì´ í•˜ë‚˜ë¡œ ì••ì¶•ì´ ëœ CA bundleì´ë‹¤. Letâ€™s encryptì—ì„œëŠ” ì²˜ìŒë¶€í„° í•˜ë‚˜ë¡œ ì••ì¶•ëœ ca-bundleì„ pem í˜•ì‹ìœ¼ë¡œ ì œê³µí•´ì¤€ë‹¤.\nChain of Trust CAê°€ ì„œëª…í•œ ì¸ì¦ì„œì˜ ë‚´ë¶€ êµ¬ì¡° CAê°€ ì„œëª…ì„ end-entityì˜ ì¸ì¦ì„œì— ì„œëª…ì„ í•˜ê²Œ ë˜ë©´ end-entityì˜ ì¸ì¦ì„œì—ëŠ” ì•„ë˜ì™€ ê°™ì€ ì •ë³´ê°€ ì¶”ê°€ë˜ì–´ ë°œê¸‰ëœë‹¤.\nëˆ„ê°€ ì„œëª…ì„ í–ˆëŠ”ì§€ (Issuer name) Issuerì˜ Digital Signature (Issuerì˜ Private keyë¡œ ì„œëª…) end-entity (Subject)ì˜ public key [Picture 9] End Entity Certificate ë‚´ë¶€ êµ¬ì¡°\nChain of Trust ê³¼ì • Chain of TrustëŠ” ë¸Œë¼ìš°ì €ê°€ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” CAê°€ Issuerë¡œ ìˆëŠ” ì¸ì¦ì„œë¥¼ ì°¾ê¸° ê¹Œì§€ ëª¨ë“  layerì˜ ì¸ì¦ì„œë¥¼ íƒìƒ‰í•˜ëŠ” ê³¼ì •ì´ë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤. ë‹¤ë¥¸ ë§ë¡œ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” CAê°€ ë°œê¸‰í•œ ì¸ì¦ì„œë¥¼ ì¦ëª…í•˜ëŠ” ê³¼ì •ì´ë‹¤. ì°¸ê³ ë¡œ ë¸Œë¼ìš°ì €ì— Root CAì˜ ì¸ì¦ì„œë¥¼ ë³´ë‚´ë„ ëŒ€ë¶€ë¶„ì€ ê·¸ ì¸ì¦ì„œë¥¼ ì“°ì§€ ì•Šê³ , ë¸Œë¼ìš°ì €ì— ì´ë¯¸ ìì²´ì ìœ¼ë¡œ ì €ì¥ì´ ë˜ì–´ìˆëŠ” Root CA ì¸ì¦ì„œë¥¼ ì‚¬ìš©í•œë‹¤.\nChain ì‹œë‚˜ë¦¬ì˜¤ End-entityì˜ ì¸ì¦ì„œ ì œì¶œ End-entityëŠ” ë¸Œë¼ìš°ì €ê°€ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” CAê°€ ì•„ë‹ˆë‹¤. End-entityì˜ Issuerë¥¼ í™•ì¸í•œë‹¤. Intermediate CAê°€ Issuerë¡œ ë˜ì–´ìˆë‹¤. Intermediate CAëŠ” ë¸Œë¼ìš°ì €ê°€ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” CAê°€ ì•„ë‹ˆë‹¤. intermediate CAì˜ Issuerë¥¼ í™•ì¸í•œë‹¤. Root CAê°€ Issuerë¡œ ë˜ì–´ìˆë‹¤. Root CAëŠ” ë¸Œë¼ìš°ì €ê°€ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” CAë‹¤. Root CAì˜ digital signatureë¥¼ ë¸Œë¼ìš°ì €ê°€ ì´ë¯¸ ê°€ì§€ê³  ìˆëŠ” Root CAì˜ public keyë¡œ verifyí•œë‹¤. Root CA digital signature verify ì™„ë£Œ. Root CA â†’ Intermediate CA â†’ End-entity ëª¨ë‘ chain of trustë¥¼ í†µí•´ì„œ ë¯¿ì„ ìˆ˜ ìˆëŠ” ì¸ì¦ì„œê°€ ëœë‹¤. [Picture 10] Chain of Trust ê³¼ì •\nChain ê³„ì¸µ [Picture 11] Chain ê³„ì¸µ\nRoot Certificate AKA Trust Anchor ìµœìƒë‹¨ì¸ RootëŠ” ë³´ì¦í•´ ì¤„ ê³³ì´ ì—†ê¸° ë•Œë¬¸ì— Root CAëŠ” self-signedì„ í•œë‹¤. OS, ì„œë“œíŒŒí‹° ì›¹ ë¸Œë¼ìš°ì €, í´ë¼ì´ì–¸íŠ¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ì€ Root CAì˜ ì¸ì¦ì„œë¥¼ ì‚¬ì „ì— ì„¤ì¹˜í•´ë‘”ë‹¤. clinetëŠ” chain of trustë¥¼ í†µí•´ì„œ end-entityê°€ Root ì— ì¸ì¦ì´ ë˜ì—ˆëŠ”ì§€ ì‹ë³„í•  ìˆ˜ ìˆë‹¤. Rootê°€ end-entityì— ì§ì ‘ ì„œëª…í•˜ëŠ” ì¼ì€ ê±°ì˜ ì—†ê³ , ì¤‘ê°„ì— í•˜ë‚˜ ë˜ëŠ” ì—¬ëŸ¬ ê°œì˜ Intermediate CAê°€ ì„œëª…ì„ í•œë‹¤. Rootì˜ Private keyê°€ ë³€ê²½ì´ ë˜ì—ˆë‹¤ë©´ í•´ë‹¹ Private keyë¡œ ë°œê¸‰ë°›ì€ ëª¨ë“  ì¸ì¦ì„œë¥¼ ì¬ë°œê¸‰ í•´ì•¼ í•œë‹¤. Intermediate Certificate ê±°ì˜ ëª¨ë“  SSL ì¸ì¦ì„œ chainì—ëŠ” ìµœì†Œ í•˜ë‚˜ì˜ Intermediate CAê°€ ë“¤ì–´ê°€ ìˆë‹¤. Intermediate CAëŠ” Root CAì˜ ì‹ ë¢°ì„±(trustworthy)ì˜ í™•ì¥ì— í•„ìˆ˜ì ì¸ ì—°ê²°ì ì´ê³ , Root CAì™€ end-entityì— ì¶”ê°€ì ì¸ ë³´ì•ˆ ë ˆë²¨ì´ ëœë‹¤. End-entity Certificate End-entityì˜ ì¸ì¦ì„œëŠ” ë³´ì•ˆ, í™•ì¥ì„±, CA compliance ë“±ì„ ì œê³µí•˜ì§€ë§Œ, ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ì€ ëŒ€ìƒ (subject)ì˜ ì‹ ë¢°ì„±ì„ ë³´ì¥í•˜ì§€ëŠ” ëª»í•œë‹¤. End-entityëŠ” í¬ë¦¬í‹°ì»¬í•œ ì •ë³´ë¥¼ CSRì— ë‹´ì•„ ì¸ì¦ì„œë¥¼ ë°œê¸‰í•´ì£¼ëŠ” CA(issuer)ì—ê²Œ ì œì¶œí•˜ê³ , CAê°€ íŒë‹¨í•˜ê¸°ì— ì œì¶œëœ ì •ë³´ê°€ ë¯¿ì„ ìˆ˜ ìˆë‹¤ë©´ CAì˜ Private keyë¡œ ì„œëª…ì„ í•œ ì¸ì¦ì„œë¥¼ ë°œê¸‰í•´ì¤€ë‹¤. ì´ ì¸ì¦ì„œê°€ verified ë˜ëŠ” signed ë˜ì–´ìˆì§€ ì•Šë‹¤ë©´ SSL connectionì€ ì‹¤íŒ¨í•œë‹¤. (plus)ì¸ì¦ì„œê°€ ì‚¬ìš©ë˜ëŠ” í”„ë¡œì„¸ìŠ¤ ëª¨ì‹ë„ ë¸Œë¼ìš°ì €ì™€ ì„œë²„ì˜ request - response ê³¼ì • ëª¨ì‹ë„\n[Picture 11] request - response ê³¼ì • ëª¨ì‹ë„\në¸Œë¼ìš°ì €ê°€ youtube.com ì„ ìš”ì²­í•œë‹¤. youtubeê°€ ì¸ì¦ì„œ ë²ˆë“¤ì„ ë¸Œë¼ìš°ì €ì— ì œì¶œí•œë‹¤. ë¸Œë¼ìš°ì €ëŠ” ìì‹ ì˜ CA public key ë¦¬ìŠ¤íŠ¸ë¡œ ì„œë²„ê°€ ì œì¶œí•œ ì¸ì¦ì„œê°€ ì •ë§ë¡œ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” CAì— ì˜í•´ ì„œëª…ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤. Intermediate CAëŠ” ì§€ì •ëœ Root CAê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ë¸Œë¼ìš°ì €ì˜ ì…ì¥ì—ì„œëŠ” ë¯¿ì„ ìˆ˜ ì—†ëŠ” CAë‹¤. ì œì¶œëœ ì¸ì¦ì„œ ë²ˆë“¤ì„ íƒ€ê³  ì˜¬ë¼ê°€ì„œ Root CAê¹Œì§€ ê°„ë‹¤. ì‹ ë¢°í•˜ê¸°ë¡œ í•œ ì¸ì¦ì„œì— ëª…ì‹œë˜ì–´ìˆëŠ” domain nameì´ë‚˜ ipê°€ ë§ë‹¤ë©´, ì„œë²„ì˜ public keyë¥¼ ì‚¬ìš©í•˜ì—¬ ëŒ€ì¹­í‚¤ë¥¼ ìƒì„±í•˜ì—¬ ì„œë²„ì™€ ê³µìœ í•œë‹¤. ì´ ëŒ€ì¹­í‚¤ë¡œ connectionì˜ ëª¨ë“  íŠ¸ë˜í”½ì„ ì•”í˜¸í™”í•œë‹¤. ëŒ€ì¹­í‚¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë¹„ëŒ€ì¹­í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ì„ ì•”í˜¸í™”í•˜ëŠ” ê²ƒë³´ë‹¤ íš¨ìœ¨ì ì´ê¸° ë•Œë¬¸ì— ëŒ€ì¹­í‚¤ë¥´ë¥´ ì‚¬ìš©í•œë‹¤. ë³µí˜¸í™”ëŠ” private keyë¥¼ ê°€ì§€ê³  ìˆëŠ” ì„œë²„ë§Œ ê°€ëŠ¥í•˜ë‹¤. CA-signed ì¸ì¦ì„œ ë°œê¸‰ ê³¼ì • ëª¨ì‹ë„\n[Picture 12] CA-signed ì¸ì¦ì„œ ë°œê¸‰ ê³¼ì • ëª¨ì‹ë„\nSelf-signed ì¸ì¦ì„œ ë°œê¸‰ ê³¼ì • ëª¨ì‹ë„\n[Picture 13] Self-signed ì¸ì¦ì„œ ë°œê¸‰ ê³¼ì • ëª¨ì‹ë„\n","date":"2022-08-27","permalink":"https://leeleelee3264.github.io/post/2022-08-27-digital-certificate-part-final/","tags":["Infra"],"title":"Digital certificate ì ìš©í•˜ê¸°"},{"content":"\noauth2ë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ” Myinfo API ë¥¼ ì‚¬ìš©í•˜ëŠ” connector clientë¥¼ Python/Djangoë¡œ êµ¬í˜„í•œë‹¤.\n[github]\n[api document]\n[quick start]\nIndex\nMyinfoë€? í”„ë¡œì íŠ¸ ëª©í‘œ í”„ë¡œì íŠ¸ êµ¬í˜„ í”„ë¡œì íŠ¸ íšŒê³  Myinfoë€? ì‹±ê°€í´ Mydata ì„œë¹„ìŠ¤ ì •ë¶€ê°€ ì£¼ë„í•œ Mydata ì„œë¹„ìŠ¤ê°€ ëª‡ ê°œì˜ ë‚˜ë¼ì— ìˆë‹¤ê³  í•˜ëŠ”ë°, ì‹±ê°€í´ ì •ë¶€ì˜ SingpassëŠ” ê·¸ ì¤‘ì—ì„œë„ ëª¨ë²”ì‚¬ë¡€ë¡œ ë½‘íŒë‹¤ê³  í•œë‹¤. SingpassëŠ” ì‹±ê°€í¬ë¥´ì˜ 15ì„¸ ì´ìƒì˜ ì¸êµ¬ ì¤‘ 97% ê°€ ì“°ê³  ìˆëŠ” ì•„ì£¼ í™œë°œí•œ ì„œë¹„ìŠ¤ì´ë‹¤.\nSingpassì— ìˆëŠ” ì—¬ëŸ¬ê°€ì§€ ì„œë¹„ìŠ¤ ì¤‘ MyinfoëŠ” Person Dataë¥¼ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ë¡œ, í•œêµ­ì˜ ì¹´ì¹´ì˜¤ë‚˜ ë„¤ì´ë²„ ì•„ì´ë”” ì²˜ëŸ¼ ouath2 ë¡œê·¸ì¸ê³¼ íšŒì›ê°€ì…ì„ í•  ìˆ˜ ìˆë‹¤. [Picture 1] ì—ì„œ singpassì— ëŒ€í•´ì„œ ì¡°ê¸ˆ ë” ìì„¸íˆ ì‚´í´ë³¼ ìˆ˜ ìˆë‹¤.\n[Picture 1] Introduce Singpass\nMyinfo oauth2 MyinfoëŠ” [Picture 2] ì™€ ê°™ì€ oauth2 êµ¬ì¡°ë¥¼ ê°€ì§„ë‹¤.\n[Picture 2] Myinfo oauth2 êµ¬ì¡°\nResource Owner Myinfo ì‚¬ìš©ì Application ë‚´ê°€ êµ¬í˜„í•˜ëŠ” connectorë¡œ, Myinfo ì‚¬ìš©ìì˜ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ì£¼ì²´ Identify Providers / Service Authorization Platform ì¸ì¦ì„œë²„ ì‚¬ìš©ìì˜ ì¸ì¦ì •ë³´ì™€ ê¶Œí•œ ì •ë³´ë¥¼ ì†Œìœ í•œ ì„œë²„ Singpass ë¡œê·¸ì¸ í˜ì´ì§€ ì œê³µ Resource Server ì‚¬ìš©ì ë°ì´í„°ë¥¼ ì†Œìœ í•œ ì„œë²„ ì¸ì¦ ì„œë²„ì— ë¡œê·¸ì¸ ì„±ê³µ í›„ ì ‘ê·¼ Myinfo Resource API ê¶Œí•œ ì¸ì¦ ìš”ì²­ [authorise api] GET /v3/authorise Singpass ë¡œê·¸ì¸ í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤. ë¡œê·¸ì¸ í›„ Singpassì—ì„œ ì‚¬ìš©ìì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì— ëŒ€í•œ ë™ì˜ë¥¼ ì§„í–‰í•œë‹¤. ì‚¬ìš©ìê°€ ë™ì˜í–ˆì„ ê²½ìš° authcodeë¥¼ return í•œë‹¤. Token ìš”ì²­ [token api] POST /v3/token authocodeë¥¼ ì‚¬ìš©í•˜ì—¬ tokenì„ ìš”ì²­í•œë‹¤. PKIë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ì¦ì„ ì§„í–‰í•œë‹¤. ì¸ì¦ì´ ì™„ë£Œë˜ë©´ tokenì„ return í•œë‹¤. ì‚¬ìš©ì ì •ë³´ ìš”ì²­ [person api] GET /v3/person/{sub} token ì†ì˜ access tokenì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ì •ë³´ë¥¼ ìš”ì²­í•œë‹¤. ì‚¬ìš©ì ì •ë³´ë¥¼ return í•œë‹¤. í”„ë¡œì íŠ¸ ëª©í‘œ Singpassê°€ ì œê³µí•˜ëŠ” [Java]ì™€ [node.js] ë²„ì „ì˜ client connector ì²˜ëŸ¼ ì´ë²ˆì— í”„ë¡œì íŠ¸ë¡œ python ë²„ì „ì˜ connectorë¥¼ ë§Œë“¤ì—ˆë‹¤. ì•„ì˜ˆ í•˜ë‚˜ì˜ REST API í˜•íƒœë¡œ ì œê³µì„ í•˜ê¸° ìœ„í•´ í”„ë ˆì„ì›Œí¬ë¡œ Djangoë¥¼ ì„ íƒí–ˆë‹¤.\ní”„ë¡œì íŠ¸ ëª©í‘œ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©´ì„œ ì´ë£¨ê³ ì í•œ ëª©í‘œëŠ” ì•„ë˜ì™€ ê°™ë‹¤. ëŒ€ë¶€ë¶„ì˜ í† ì´ í”„ë¡œì íŠ¸ê°€ ì œëŒ€ë¡œ ì •ë¦¬ê°€ ë˜ì–´ìˆì§€ ì•Šê±°ë‚˜ ì½”ë“œê°€ ì—‰ë§ìœ¼ë¡œ ì§œì—¬ì§ˆ ë•Œê°€ ë§ì•„ì„œ ì´ë²ˆì—ëŠ” ì²˜ìŒë¶€í„° í™•ì‹¤í•˜ê²Œ ëª©í‘œë¥¼ ì„¤ì •í–ˆë‹¤.\nCode Quality\nDDD ì•„í‚¤í…ì²˜ë¡œ ì„œë²„ë¥¼ êµ¬í˜„í•œë‹¤. ìµœì†Œ 2íšŒì˜ ë¦¬íŒ©í† ë§ì„ ì§„í–‰í•œë‹¤. python lint(flake8, pylint, mypy)ë¥¼ ì‚¬ìš©í•˜ì—¬ ìµœëŒ€í•œ python styleì„ ê³ ìˆ˜í•œë‹¤. Pipenvë¥¼ ì‚¬ìš©í•´ì„œ python íŒ¨í‚¤ì§€ë¥¼ ê´€ë¦¬í•œë‹¤. Documentation\nGithub READMEë¥¼ ì‘ì„±í•œë‹¤. API documentë¥¼ ì‘ì„±í•œë‹¤. Projectì— ëŒ€í•œ ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…ì„ ì‘ì„±í•œë‹¤. Dev Stack stack info Backend Language Python Backend Framework Django Code Architecture Domain Driven Desgin Python Package Managment Pipenv API Security PKI Version Control Github API Document GitBook í”„ë¡œì íŠ¸ êµ¬í˜„ Make Request Myinfo oauth2 êµ¬ì¡°ë¥¼ ë°˜ì˜í•˜ì—¬, connector ì„œë²„ì˜ í˜¸ì¶œ flowë¥¼ [Picture 3] ê°™ì´ ì„¤ê³„í–ˆë‹¤.\n[Picture 3] connector ì„œë²„ í˜¸ì¶œ flow\nStep 1: Get myinfo login url Request GET /users/me/external/myinfo-redirect-login\ncurl -i -H 'Accept: application/json' \u0026lt;http://localhost:3001/user/me/external/myinfo-redirect-login\u0026gt; Response { \u0026quot;message\u0026quot;: \u0026quot;OK\u0026quot;, \u0026quot;data\u0026quot;: { \u0026quot;url\u0026quot;: \u0026quot;https://test.api.myinfo.gov.sg/com/v3/authorise?client_id=STG2-MYINFO-SELF-TEST\u0026amp;attributes=name,dob,birthcountry,nationality,uinfin,sex,regadd\u0026amp;state=eb03c000-00a3-4708-ab30-926306bfc4a8\u0026amp;redirect_uri=http://localhost:3001/callback\u0026amp;purpose=python-myinfo-connector\u0026quot;, \u0026quot;state\u0026quot;: \u0026quot;eb03c000-00a3-4708-ab30-926306bfc4a8\u0026quot; } } Step 2: Browse myinfo login url Request curl \u0026lt;https://test.api.myinfo.gov.sg/com/v3/authorise?client_id=STG2-MYINFO-SELF-TEST\u0026amp;attributes=name,dob,birthcountry,nationality,uinfin,sex,regadd\u0026amp;state=eb03c000-00a3-4708-ab30-926306bfc4a8\u0026amp;redirect_uri=http://localhost:3001/callback\u0026amp;purpose=python-myinfo-connector\u0026gt; Response [Picture 4] Myinfo Login Page\nStep 3: Login and check agree terms Login Check Login page in [Picture 5]\nAgree Terms [Picture 5] Myinfo Terms Agreement Page\nStep 4: Callback API get called by Myinfo Myinfoì—ì„œ Requestë¥¼ í•˜ëŠ” Stepì´ë‹¤.\në¡œê·¸ì¸ì„ í•˜ê³  termsì— ë™ì˜ë¥¼ í•˜ë©´ Myinfoì—ì„œ connector clientì˜ callback APIë¥¼ í˜¸ì¶œí•´ authcodeë¥¼ ë„˜ê²¨ì¤€ë‹¤.\nRequest GET /callback?{code}\ncurl \u0026lt;http://localhost:3001/callback?code=8932a98da8720a10e356bc76475d76c4c628aa7f\u0026amp;state=e2ad339a-337f-45ec-98fa-1672160cf463\u0026gt; Response [Picture 6] Callback Response Page\nFinal Step: Get Person data ìë™í™”ëœ Stepì´ë‹¤.\nCallback APIì˜ ì‘ë‹µì¸ callback í˜ì´ì§€ëŠ” ìë™ìœ¼ë¡œ connector clientì˜ person data APIë¥¼ í˜¸ì¶œí•˜ë„ë¡ í–ˆë‹¤. í•´ë‹¹ APIê°€ Myinfoì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë§ˆì§€ë§‰ ë‹¨ê³„ì´ë‹¤.\nRequest GET /users/me/external/myinfo\ncurl -i -H 'Accept: application/json' \u0026lt;http://localhost:3001/user/me/external/myinfo\u0026gt; Response { \u0026quot;message\u0026quot;: \u0026quot;OK\u0026quot;, \u0026quot;sodata\u0026quot;: { \u0026quot;regadd\u0026quot;: { \u0026quot;country\u0026quot;: { \u0026quot;code\u0026quot;: \u0026quot;SG\u0026quot;, \u0026quot;desc\u0026quot;: \u0026quot;SINGAPORE\u0026quot; }, \u0026quot;unit\u0026quot;: { \u0026quot;value\u0026quot;: \u0026quot;10\u0026quot; }, \u0026quot;street\u0026quot;: { \u0026quot;value\u0026quot;: \u0026quot;ANCHORVALE DRIVE\u0026quot; }, \u0026quot;lastupdated\u0026quot;: \u0026quot;2022-07-14\u0026quot;, \u0026quot;block\u0026quot;: { \u0026quot;value\u0026quot;: \u0026quot;319\u0026quot; }, \u0026quot;source\u0026quot;: \u0026quot;1\u0026quot;, \u0026quot;postal\u0026quot;: { \u0026quot;value\u0026quot;: \u0026quot;542319\u0026quot; }, \u0026quot;classification\u0026quot;: \u0026quot;C\u0026quot;, \u0026quot;floor\u0026quot;: { \u0026quot;value\u0026quot;: \u0026quot;38\u0026quot; }, \u0026quot;type\u0026quot;: \u0026quot;SG\u0026quot;, \u0026quot;building\u0026quot;: { \u0026quot;value\u0026quot;: \u0026quot;\u0026quot; } }, \u0026quot;dob\u0026quot;: \u0026quot;1988-10-06\u0026quot;, \u0026quot;sex\u0026quot;: \u0026quot;M\u0026quot;, \u0026quot;name\u0026quot;: \u0026quot;ANDY LAU\u0026quot;, \u0026quot;birthcountry\u0026quot;: \u0026quot;SG\u0026quot;, \u0026quot;nationality\u0026quot;: \u0026quot;SG\u0026quot;, \u0026quot;uinfin\u0026quot;: \u0026quot;S6005048A\u0026quot; } } PKI Digital Signature MyinfoëŠ” PKI Digital Signatureë¥¼ í•„ìš”ë¡œ í•œë‹¤. í•´ë‹¹ ë¬¸ì„œì—ì„œëŠ” pythonì—ì„œ êµ¬í˜„ì„ í•  ë•Œ PKIë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ë§Œì„ ë‹¤ë£¨ê¸° ë•Œë¬¸ì— PKIì— ëŒ€í•œ ë” ìì„¸í•œ ì„¤ëª…ì€ ë§í¬ë¡œ ì²¨ë¶€í•˜ê² ë‹¤. [LeeLee- Digital Certificate]\npython íŒ¨í‚¤ì§€ë¡œëŠ” *jwcrypto*ì™€ Cryptoë¥¼ ì‚¬ìš©í–ˆë‹¤.\nPKI ì‹œë‚˜ë¦¬ì˜¤ connector client private key\n[myinfo token api]ë¥¼ í˜¸ì¶œí•  ë•Œ [myinfo person api]ë¥¼ í˜¸ì¶œ í•  ë•Œ [myinfo person api] ì‘ë‹µ decrypt í•  ë•Œ myinfoì—ì„œ connector clientì˜ public keyë¡œ ì‘ë‹µì„ ì•”í˜¸í™” í–ˆê¸° ë•Œë¬¸ myinfo public key\nmyinfo token api ì‘ë‹µ verify í•  ë•Œ myinfoì—ì„œ myinfoì˜ private keyë¡œ ì‘ë‹µì„ ì•”í˜¸í™” í–ˆê¸° ë•Œë¬¸ myinfo person api ì‘ë‹µ verify í•  ë•Œ myinfoì—ì„œ myinfoì˜ private keyë¡œ ì‘ë‹µì„ ì•”í˜¸í™” í–ˆê¸° ë•Œë¬¸ public, privateKey ë¶ˆëŸ¬ì˜¤ê¸° 1 2 3 4 5 6 7 8 9 10 11 from jwcrypto import jwk PrivateKey = jwk.JWK PublicKey = jwk.JWK def _get_key(self, key: str) -\u0026gt; Union[PrivateKey, PublicKey]: encode_key = key.encode(\u0026#39;utf-8\u0026#39;) key_dict = jwk.JWK.from_pem(encode_key) return key_dict connector client private keyë¡œ ì„œëª…í•˜ê¸° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 import base64 from Crypto.Hash import SHA256 from Crypto.PublicKey import RSA from Crypto.Signature import PKCS1_v1_5 Signature = str def _sign_on_raw_header( self, base_string: str, private_key: str, ) -\u0026gt; Signature: digest = SHA256.new() digest.update( base_string.encode(\u0026#39;utf-8\u0026#39;), ) pk = RSA.importKey(private_key) signer = PKCS1_v1_5.new(pk) signature = str(base64.b64encode(signer.sign(digest)), \u0026#39;utf-8\u0026#39;) return signature connector client private keyë¡œ ì‘ë‹µ decrypt í•˜ê¸° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 import json from jwcrypto import ( jwe, jwk, ) PrivateKey = jwk.JWK def _decrypt( self, encrypted_payload: str, key: PrivateKey, ) -\u0026gt; DecryptedPersonData: params = self._get_decrypt_params(encrypted_payload) encryption = jwe.JWE() encryption.deserialize(params, key) data = encryption.plaintext data_str = json.loads(data) return data_str myinfo public keyë¡œ ì‘ë‹µ verify í•˜ê¸° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import json from jwcrypto import jwk PublicKey = jwk.JWK DecodedPersonData = dict def _decode( self, encoded_payload: str, key: PublicKey, ) -\u0026gt; DecodedPersonData: token = jwt.JWT() token.deserialize(jwt=encoded_payload, key=key) data = token.claims data_dict = json.loads(data) person = DecodedPersonData(**data_dict) return person í”„ë¡œì íŠ¸ íšŒê³  ë¬¸ì„œí™” ì •í•´ë‘” ëª©í‘œë¥¼ ì˜ ì´í–‰í•œ ê¸°ë¶„ì´ ë“¤ì–´ì„œ ë¿Œë“¯í–ˆë‹¤. ë˜í•œ í•­ìƒ ë¯¸í¡í–ˆë˜ ë¬¸ì„œí™”ë¥¼ ê¼¼ê¼¼í•˜ê²Œ í•´ ë‘” ê±° ê°™ì•„ ë§Œì¡±ìŠ¤ëŸ½ë‹¤. í•˜ì§€ë§Œ ë¬¸ì„œí™”ë¥¼ í•˜ëŠ” ê³¼ì •ì—ì„œ ì–´ë–»ê²Œ ë‚´ê°€ ë§í•˜ê³ ì í•˜ëŠ” ë°”ë¥¼ ë” ê¹”ë”í•˜ê²Œ ê¸€ë¡œ ì˜®ê¸¸ ìˆ˜ ìˆì„ê¹Œ ê³ ë¯¼ì„ ë§ì´ í–ˆê³ , ì•„ì§ë„ ë¶€ì¡±í•œ ë¶€ë¶„ì´ ë§ì´ ë³´ì¸ë‹¤. ë¦¬íŒ©í† ë§ ì½”ë“œ ë˜í•œ 2ë²ˆ ë¦¬íŒ©í† ë§ì„ ì§„í–‰í–ˆì§€ë§Œ í¬ìŠ¤íŒ…ì„ ìœ„í•´ì„œ ë‹¤ì‹œ ì½”ë“œë¥¼ ë³´ë‹ˆ ë˜ ë¦¬íŒ©í† ë§ í•´ì•¼ê² ë‹¤ëŠ” ìƒê°ì´ ë“ ë‹¤. í”„ë¡œì íŠ¸ë¥¼ í•  ë•Œ 1,2ë²ˆì˜ ë¦¬íŒ©í† ë§ì„ í•˜ê³  í”„ë¡œì íŠ¸ê°€ ëë‚˜ê³  2~3ë‹¬ ì§€ë‚˜ì„œ ë¦¬íŒ©í† ë§ì„ 1 ë²ˆ ì§„í–‰í•˜ë©´ ì¢‹ì„ ê±° ê°™ë‹¤. Boilerplate ì–´ë–¤ í”„ë¡œì íŠ¸ë¥¼ í•˜ë”ë¼ë„ í”„ë ˆì„ì›Œí¬ settingì„ í•˜ëŠ”ë° ì´ˆê¸° ì‹œê°„ì„ ë§ì´ ì†Œìš”í•˜ëŠ”ë°, ì•ìœ¼ë¡œ Djangoë¡œ ê³„ì† í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•  ì˜ˆì •ì´ë¼ë©´ pre-settingì´ ì–´ëŠ ì •ë„ ë˜ì–´ìˆëŠ” Django Boilerplate ë¥¼ ë§Œë“¤ì–´ì•¼ê² ë‹¤.\n","date":"2022-07-23","permalink":"https://leeleelee3264.github.io/post/2022-07-23-project-myinfo-connector-python/","tags":["Project"],"title":"Pythonìœ¼ë¡œ Myinfo oauth2 client connector êµ¬í˜„í•˜ê¸°"},{"content":"\nê°„ë‹¨í•œ í”„ë¡œíŒŒì¼ë§ì„ í•  ìˆ˜ ìˆëŠ” profilerë¥¼ Python decoratorë¡œ êµ¬í˜„í•œë‹¤.\nIndex\nprofiler êµ¬í˜„ ê³„ê¸° profiler êµ¬í˜„ ê°œì„ í•´ì•¼ í•˜ëŠ” ë¶€ë¶„ profiler êµ¬í˜„ ê³„ê¸° Django í™˜ê²½ì—ì„œ unittestë¥¼ í•˜ë©° ê°„ë‹¨í•˜ê²Œ í¼í¬ë¨¼ìŠ¤ë¥¼ ì¸¡ì •í•˜ê³  ì‹¶ì—ˆë‹¤. ì•„ì£¼ ê°„ë‹¨í•˜ê²Œ í”„ë¡œíŒŒì¼ë§ì„ í•˜ë©´ ë˜ê¸° ë•Œë¬¸ì— Middleware ê°™ì€ ê²ƒì€ ë§Œë“¤ì§€ ì•Šì•˜ë‹¤. ëŒ€ì‹ ì— Pythonì˜ decoratorë¡œ ë§Œë“¤ì—ˆë‹¤. ì•ìœ¼ë¡œ ë” ì‹¬í™”ë˜ê³  ìœ ìµí•œ ì •ë³´ë¥¼ í¬í•¨í•˜ê³  ìˆëŠ” Profilerë¥¼ decorator í˜•ì‹ìœ¼ë¡œ ë§Œë“¤ë©´ ìœ ìš©í•  ê²ƒ ê°™ë‹¤.\nêµ¬í˜„í•œ profiler\në©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ë³´ê¸° ìœ„í•œ ram_profiler í•¨ìˆ˜ì—ì„œ í˜¸ì¶œëœ ì¿¼ë¦¬ì™€ ì¿¼ë¦¬ ì‹¤í–‰ì‹œê°„ì„ ë³´ê¸° ìœ„í•œ query_profiler í•¨ìˆ˜ ì‹¤í–‰ì‹œê°„ ì„ ë³´ê¸° ìœ„í•œ elapsed_timer profiler êµ¬í˜„ ram_profiler ì´ í”„ë¡œíŒŒì¼ëŸ¬ë¥¼ êµ¬í˜„í•˜ë‹¤ê°€ ì•Œê²Œ ëœ ì‚¬ì‹¤ì¸ë° Pythonì—ì„œ ë©”ëª¨ë¦¬ë‚˜ CPU ì‚¬ìš©ëŸ‰ì„ ë³´ë ¤ë©´ psutill builtin íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ê°€ ë§ì•˜ë‹¤.\ndecoratorëŠ” í•¨ìˆ˜ í˜¸ì¶œ ì „ê³¼ í›„ì˜ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ê°€ì ¸ì™€, í•¨ìˆ˜ê°€ í˜¸ì¶œì´ ë˜ë©´ì„œ ì–¼ì¶” ì–´ëŠ ì •ë„ì˜ ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í–ˆëŠ”ì§€ ë¹„êµí•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.\nram_profiler êµ¬í˜„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 def ram_profiler(fn): \u0026#34;\u0026#34;\u0026#34; í¼í¬ë¨¼ìŠ¤ ì²´í¬ë¥¼ ìœ„í•œ ë©”ëª¨ë¦¬ í”„ë¡œíŒŒì¼ëŸ¬ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ì¸¡ì •í•  í•¨ìˆ˜ ìœ„ì— @ram_profiler ë¥¼ ì¶”ê°€í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤. ì²´í¬í•˜ëŠ” ë©”ëª¨ë¦¬ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. 1) ê·¸ëƒ¥ í˜„ì¬ memory usage ì •ë³´ë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜¤ëŠ” ê²½ìš° 2) í˜„ì¬ process idë¥¼ í†µí•´ í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ì˜ memory usageë¥¼ ì •í™•í•˜ê²Œ ë¹„êµí•˜ëŠ” ê²½ìš° ex) @ram_profiler def pre_allot_offering(offering: Offering): \u0026#34;\u0026#34;\u0026#34; def inner(*args, **kwargs): print(\u0026#39;\\n\u0026#39;) print(\u0026#34;===== memory usage check =====\u0026#34;) memory_usage_dict = dict(psutil.virtual_memory()._asdict()) memory_usage_percent = memory_usage_dict[\u0026#39;percent\u0026#39;] print(f\u0026#34;BEFORE CODE :: memory_usage_percent: {memory_usage_percent}%\u0026#34;) pid = os.getpid() current_process = psutil.Process(pid) current_process_memory_usage_as_kb = current_process.memory_info()[0] / 2. ** 20 print(f\u0026#34;BEFORE CODE :: Current memory KB : {current_process_memory_usage_as_kb: 9.3f} KB\u0026#34;) target_func = fn(*args, **kwargs) print(\u0026#34;==\u0026#34; * 20) print(f\u0026#34;== {fn.__name__} memory usage check ==\u0026#34;) memory_usage_dict = dict(psutil.virtual_memory()._asdict()) memory_usage_percent = memory_usage_dict[\u0026#39;percent\u0026#39;] print(f\u0026#34;AFTER CODE :: memory_usage_percent: {memory_usage_percent}%\u0026#34;) pid = os.getpid() current_process = psutil.Process(pid) current_process_memory_usage_as_kb = current_process.memory_info()[0] / 2. ** 20 print(f\u0026#34;AFTER CODE :: Current memory KB : {current_process_memory_usage_as_kb: 9.3f} KB\u0026#34;) print(\u0026#39;\\n\u0026#39;) return target_func return inner ram_profiler ê²°ê³¼ ===== memory usage check ===== BEFORE CODE :: memory_usage_percent: 79.7% BEFORE CODE :: Current memory KB : 197.250 KB ======================================== == pre_allot_offering memory usage check == AFTER CODE :: memory_usage_percent: 79.7% AFTER CODE :: Current memory KB : 197.312 KB query_profiler decoratorëŠ” ì¿¼ë¦¬ë¥¼ ê´€ë¦¬í•˜ëŠ” contextë¥¼ ì„í¬íŠ¸ í•´ì™€ì„œ íƒ€ê²Ÿ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë©´ì„œ í˜¸ì¶œë˜ì—ˆë˜ ì¿¼ë¦¬ë“¤ì„ ìº¡ì²˜í•´ë‘ì—ˆë‹¤ê°€ í•¨ìˆ˜ê°€ ëì´ ë‚˜ë©´ ë³´ì—¬ì¤€ë‹¤. ORMì—ì„œ ì‹¤ì œë¡œ ì–´ë–¤ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ëŠ”ì§€ ë´ì•¼ í•  ë•Œ, ì¡°ê±´ë¬¸ì— ë”°ë¼ ì¿¼ë¦¬ê°€ ë‹¬ë¼ì§ˆ ë•Œ, N + 1 ì¿¼ë¦¬ë¥¼ ì¡ì•„ ë‚¼ ë•Œ ì‚¬ìš©í•˜ê¸° ì¢‹ë‹¤.\nquery_profiler êµ¬í˜„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 def query_profiler(fn): \u0026#34;\u0026#34;\u0026#34; í˜¸ì¶œì´ ëœ queryë¥¼ í™•ì¸í•˜ê¸° ìœ„í•œ í”„ë¡œíŒŒì¼ëŸ¬ í˜¸ì¶œ ëœ queryë¥¼ í™•ì¸í•  í•¨ìˆ˜ ìœ„í—¤ @query_profiler ë¥¼ ì¶”ê°€í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤. ex) @query_profiler def pre_allot_offering(offering: Offering): \u0026#34;\u0026#34;\u0026#34; def inner(*args, **kwargs): print(\u0026#39;\\n\u0026#39;) print(f\u0026#34;===== {fn.__name__} called query check =====\u0026#34;) with CaptureQueriesContext(connection) as context: target_func = fn(*args, **kwargs) for index, query in enumerate(context.captured_queries): sql = query.get(\u0026#39;sql\u0026#39;) time = query.get(\u0026#39;time\u0026#39;) print(f\u0026#39;CALLED QUERY :: [{index}]\u0026#39;) print(f\u0026#39;CALLED QUERY :: query: {sql}\u0026#39;) print(f\u0026#39;CALLED QUERY :: executed time: {time}\u0026#39;) print(\u0026#34;=====\u0026#34;) return target_func return inner query_profiler ê²°ê³¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 ===== pre_allot_offering called query check ===== CALLED QUERY :: [0] CALLED QUERY :: query: SAVEPOINT `s4377609600_x5` CALLED QUERY :: executed time: 0.001 ===== CALLED QUERY :: [1] CALLED QUERY :: query: SELECT `offering_subscription`.`id` # ì‹¤ì œ ì¿¼ë¦¬ëŠ” ë¸”ë¼ì¸ë“œ CALLED QUERY :: executed time: 0.00 ===== CALLED QUERY :: [2] CALLED QUERY :: query: UPDATE `offering_subscription` SET # ì‹¤ì œ ì¿¼ë¦¬ëŠ” ë¸”ë¼ì¸ë“œ CALLED QUERY :: executed time: 0.003 ===== CALLED QUERY :: [3] CALLED QUERY :: query: SELECT `offering_subscription`.`id`, # ì‹¤ì œ ì¿¼ë¦¬ëŠ” ë¸”ë¼ì¸ë“œ ===== CALLED QUERY :: [4] CALLED QUERY :: query: SELECT `offering_subscription`.`id`, # ì‹¤ì œ ì¿¼ë¦¬ëŠ” ë¸”ë¼ì¸ë“œ CALLED QUERY :: executed time: 0.002 ===== CALLED QUERY :: [5] CALLED QUERY :: query: UPDATE `offering_subscription` SET # ì‹¤ì œ ì¿¼ë¦¬ëŠ” ë¸”ë¼ì¸ë“œ CALLED QUERY :: executed time: 0.002 ===== CALLED QUERY :: [6] CALLED QUERY :: query: RELEASE SAVEPOINT `s4377609600_x5` CALLED QUERY :: executed time: 0.001 ===== elapsed_timer decoratorëŠ” í•¨ìˆ˜ì˜ ì‹œì‘ì‹œê°„ê³¼ ëë‚˜ëŠ” ì‹œê°„ì„ ì¸¡ì •í•˜ì—¬ í•¨ìˆ˜ ì‹¤í–‰ì‹œê°„ì´ ì–´ëŠì •ë„ì¸ì§€ë¥¼ ê³„ì‚°í•œë‹¤.\nelapsed_timer êµ¬í˜„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 def elapsed_timer(fn): \u0026#34;\u0026#34;\u0026#34; í¼í¬ë¨¼ìŠ¤ ì²´í¬ë¥¼ ìœ„í•œ ì‹¤í–‰ ì‹œê°„ ì¸¡ì • íƒ€ì´ë¨¸ ì‹¤í–‰ ì‹œê°„ì„ ì¸¡ì •í•  í•¨ìˆ˜ ìœ„ì— @elapsed_timer ë¥¼ ì¶”ê°€í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤. í¼í¬ë¨¼ìŠ¤ í…ŒìŠ¤íŠ¸ê°€ ëë‚˜ë©´ ì§€ì›Œì£¼ì‹œê¸¸ ë°”ëë‹ˆë‹¤. ex) @elapsed_timer def pre_allot_offering(offering: Offering): \u0026#34;\u0026#34;\u0026#34; def inner(*args, **kwargs): print(\u0026#39;\\n\u0026#39;) print(f\u0026#34;===== {fn.__name__} elapsed time check =====\u0026#34;) start = perf_counter() target_func = fn(*args, **kwargs) end = perf_counter() print(f\u0026#39;ELAPSED :: total: start: {start} sec - end: {end} sec\u0026#39;) duration = end - start print(f\u0026#39;ELAPSED :: duration: {duration} sec\u0026#39;) print(f\u0026#39;ELAPSED :: duration in minutes : {str(timedelta(seconds=duration))} mins\u0026#39;) print(\u0026#39;\\n\u0026#39;) return target_func return inner elapsed_timer ê²°ê³¼ 1 2 3 4 ===== pre_allot_offering elapsd time check ===== ELAPSED :: total: start: 8.705878 sec - end: 8.72449375 sec ELAPSED :: duration: 0.018615750000000375 sec ELAPSED :: duration in minutes : 0:00:00.018616 mins (builtin) @profiler ë©”ëª¨ë¦¬ë¥¼ í”„ë¡œíŒŒì¼ë§í•˜ëŠ” ê²ƒì— í•œì •í•œë‹¤ë©´ Pythonì—ì„œ builtinìœ¼ë¡œ ì œê³µí•˜ëŠ” memory_profiler ë¼ëŠ” ê²ƒì´ ìˆë‹¤. íŒ¨í‚¤ì§€ ì•ˆì˜ @profiler ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•˜ë©´ í•¨ìˆ˜ ì•ˆì—ì„œ ì½”ë“œê°€ ì‹¤í–‰ì´ ë  ë•Œ í•œ ì¤„ í•œ ì¤„ ì–¼ë§ˆì˜ ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í–ˆëŠ”ì§€ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.\nORMì„ í¬í•¨í•˜ê³  ìˆëŠ” ì½”ë“œì—ë„ ì‚¬ìš©ì„ í•´ë³´ë ¤ í–ˆëŠ”ë° recursive í•˜ê²Œ ë™ì‘ì„ í•˜ë‹¤ê°€ ìŠ¤íƒì´ í„°ì ¸ì„œ ì‚¬ìš©ì„ í•  ìˆ˜ ì—†ì—ˆë‹¤. í•¨ìˆ˜ê°€ í•œ ì¤„ ì”© í˜¸ì¶œë˜ë©´ì„œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ë³´ê¸°ì—ëŠ” ì •ë§ ì¢‹ì€ ë°ì½”ë ˆì´í„° ì²˜ëŸ¼ ë³´ì´ëŠ”ë° ê¼­ ë‹¤ìŒì— ì¨ë³´ë„ë¡ í•´ì•¼ê² ë‹¤.\n@profiler ì‚¬ìš© ì˜ˆì‹œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 from memory_profiler import profile @profile def main_func(): import random arr1 = [random.randint(1,10) for i in range(100000)] arr2 = [random.randint(1,10) for i in range(100000)] arr3 = [arr1[i]+arr2[i] for i in range(100000)] del arr1 del arr2 tot = sum(arr3) del arr3 print(tot) if __name__ == \u0026#34;__main__\u0026#34;: main_func() @profiler ê²°ê³¼ ì˜ˆì‹œ 1 2 3 4 5 6 7 8 9 10 11 12 13 Line # Mem usage Increment Line Contents ================================================ 3 37.0 MiB 37.0 MiB @profile 4 def main_func(): 5 37.0 MiB 0.0 MiB import random 6 37.6 MiB 0.3 MiB arr1 = [random.randint(1,10) for i in range(100000)] 7 38.4 MiB 0.3 MiB arr2 = [random.randint(1,10) for i in range(100000)] 8 39.9 MiB 0.5 MiB arr3 = [arr1[i]+arr2[i] for i in range(100000)] 9 39.9 MiB 0.0 MiB del arr1 10 38.0 MiB 0.0 MiB del arr2 11 38.0 MiB 0.0 MiB tot = sum(arr3) 12 37.2 MiB 0.0 MiB del arr3 13 37.2 MiB 0.0 MiB print(tot) ê°œì„ í•´ì•¼ í•˜ëŠ” ë¶€ë¶„ Pythonì˜ DecoratorëŠ” í•¨ìˆ˜ì˜ ì‹œì‘ - ë ë¶€ë¶„ì— ì¶”ê°€ actionì„ í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” Wrapperì´ë‹¤. í•¨ìˆ˜ ì¤‘ê°„ì¤‘ê°„ì— í”„ë¡œíŒŒì¼ë§ì„ í•´ì•¼ í•œë‹¤ë©´ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ì ‘ê·¼ì„ í•´ì•¼ í•  ê²ƒ ê°™ë‹¤.\n","date":"2022-06-29","permalink":"https://leeleelee3264.github.io/post/2022-06-30-python-profiler-decorator/","tags":["Backend"],"title":"Python decoratorë¡œ ê°„ë‹¨í•œ profiler êµ¬í˜„í•˜ê¸°"},{"content":"\nPKIì˜ certificateì— ëŒ€í•´ì„œ ë‹¤ë£¬ë‹¤.\nIndex\nì¸ì¦ì„œì— ëŒ€í•´ ì˜ëª» ì•Œê³  ìˆë˜ ì ë“¤ ì¸ì¦ì„œì˜ ì¢…ë¥˜ ì¸ì¦ì„œì™€ ê´€ë ¨ëœ ê°œë… ì¸ì¦ì„œì— ëŒ€í•´ ì˜ëª» ì•Œê³  ìˆë˜ ì ë“¤ ì¸ì¦ì„œì˜ ì¢…ë¥˜ ì ì ˆí•˜ì§€ ì•Šì€ ì¸ì¦ì„œ ë¶„ë¥˜ webì—ì„œ HTTPS í†µì‹ ì„ í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” web secureìš© SSL ì¸ì¦ì„œ digital signature(ë””ì§€í„¸ ì„œëª…) ë¥¼ í•˜ê¸° ìœ„í•œ code signing ì¸ì¦ì„œ ë””ì§€í„¸ ì„œëª…ì„ í•´ì•¼ í–ˆê¸° ë•Œë¬¸ì— code signing ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ìœ¼ë ¤ í–ˆë‹¤. í•˜ì§€ë§Œ SSL ì¸ì¦ì„œë„ ë””ì§€í„¸ ì„œëª…ì„ í•  ìˆ˜ ìˆì—ˆê³ , ëª©í‘œì¸ server to server ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì‹ ì› ë³´ì¥ìš© ë””ì§€í„¸ ì„œëª…ì„ í•˜ê¸° ìœ„í•´ì„œëŠ” SSL ì¸ì¦ì„œë¥¼ ë°œê¸‰í•´ì•¼ í–ˆë‹¤.\n[Picture 1] ì ì ˆí•˜ì§€ ì•Šì€ ì¸ì¦ì„œ ë¶„ë¥˜\nì ì ˆí•œ ì¸ì¦ì„œ ë¶„ë¥˜ SSL ì¸ì¦ì„œëŠ” ì›¹ì‚¬ì´íŠ¸, ì •í™•íˆ ë§í•˜ë©´ ë¸Œë¼ìš°ì €ì— í•œì •í•´ì„œ ì‚¬ìš©í•œë‹¤ê³  ìƒê°í–ˆëŠ”ë° ì´ëŠ” ë„ˆë¬´ í•œì •ì ì¸ ìƒê°ì´ì—ˆë‹¤. SSL ì¸ì¦ì„œëŠ” clientì™€ serverê°€ (browser to server / server to server) ë°ì´í„°ë¥¼ ì£¼ê³  ë°›ì„ ë•Œ ì•”í˜¸í™”ë¥¼ í•˜ê¸° ìœ„í•´ ì“°ì´ê¸° ë•Œë¬¸ì— ë¸Œë¼ìš°ì €ì— í•œì •ì ì´ì§€ ì•Šë‹¤.\nê²°êµ­ ì¸ì¦ì„œëŠ” [Picture 2] ì²˜ëŸ¼ ë¶„ë¥˜ë¥¼ í•´ì•¼ í•œë‹¤.\n[Picture 2] ì ì ˆí•œ ì¸ì¦ì„œ ë¶„ë¥˜\nCode Signing ì¸ì¦ì„œ ë°œê¸‰ë°›ìœ¼ë ¤ í–ˆë˜ code signing ì¸ì¦ì„œëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ì„œëª…ì„ í•´ì„œ í•´ë‹¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ publisherì˜ ì‹ ì›ì„ ë³´ì¥í•˜ëŠ”ë° ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë‚´ê°€ í•„ìš”í–ˆë˜ server to server ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì¸ì¦ì„œê°€ ì•„ë‹ˆë‹¤.\ncode signing ì¸ì¦ì„œë¡œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ì„œëª…ì„ í•˜ê²Œ ë˜ë©´ [Picture 3] ì™€ ê°™ì´ ì‚¬ìš©ìì—ê²Œ ì–´í”Œë¦¬ì¼€ì´ì…˜ publisher ì— ëŒ€í•œ ì •ë³´ê°€ ì¶”ê°€ë¡œ ì œê³µì´ ëœë‹¤.\n[Picture 3] code signing ì¸ì¦ì„œë¡œ ì„œëª…í•œ application\nCSR ìƒì„±í•˜ê¸° ëª¨ë“  SSL ì¸ì¦ì„œëŠ” domain validationì„ í•œë‹¤. ì´ ìƒê°ì— ì‚¬ë¡œì¡í˜€ì„œ Root CAê°€ ì„œëª…í•œ ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ê¸° ìœ„í•´ ì œì¶œí•´ì•¼ í•˜ëŠ” CSRëŠ” ì¸ì¦ì„œê°€ ì‚¬ìš©ì´ ë  ì„œë²„ì—ì„œ ë§Œë“¤ì–´ì•¼ í•œë‹¤ê³  ìƒê°í–ˆë‹¤.\nì˜ˆë¥¼ ë“¤ì–´ leelee.me ì´ë¼ëŠ” ë£¨íŠ¸ ë„ë©”ì¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì¸ì¦ì„œë¼ê³  í–ˆì„ ë•Œ leelee.me ë„ë©”ì¸ì„ í˜¸ìŠ¤íŒ…í•˜ëŠ” ì„œë²„ì—ì„œ CSRì„ ìƒì„±í•´ì•¼ í•œë‹¤ê³  ìƒê°í•œ ê²ƒì´ë‹¤. í•˜ì§€ë§Œ CSRì„ ë‹¤ë¥¸ ì„œë²„ì—ì„œ ìƒì„±í–ˆë‹¤ë©´, CSRì„ ìƒì„±í•  ë•Œ í•¨ê»˜ ë§Œë“  private keyë¥¼ ì¸ì¦ì„œë¥¼ ì‚¬ìš©í•  ì„œë²„ë¡œ ì˜®ê¸°ë©´ ëœë‹¤.\nì¸ì¦ì„œì˜ ì¢…ë¥˜ SSL Certificate VS Code Signing Certificate ê³µí†µì \nX.509 í˜•íƒœì˜ ë””ì§€í„¸ ì¸ì¦ì„œë‹¤. PKI í˜•ì‹ì„ ì‚¬ìš©í•œë‹¤. ë‘ ì¸ì¦ì„œê°€ ì—†ë‹¤ë©´ ì‚¬ìš©ìì—ê²Œ ë³´ì•ˆ ê²½ê³ ê°€ ë„ì›Œì§„ë‹¤. ë°œê¸‰í•˜ê¸° ì „ì— CAì—ì„œ ë°œê¸‰ìš”ì²­ìë¥¼ ê²€ì¦í•œë‹¤. end userë“¤ì´ í•´í‚¹ë“±ì˜ ì‚¬ì´ë²„ ë²”ì£„ì— ë…¸ì¶œë˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤. ì°¨ì´ì \nSSL Certificateì€ ë‘ ì‹œìŠ¤í…œì—ì„œ ì˜¤ê³ ê°€ëŠ” dataë¥¼ ì•”í˜¸í™”í•œë‹¤. Code Signing Certificateì€ ì†Œí”„íŠ¸ì›¨ì–´ ìì²´ë¥¼ hash \u0026amp; sign í•œë‹¤. ëª¨ë“  ì½”ë“œì— ë””ì§€í„¸ ì„œëª…ì„ í•œ ê²ƒê³¼ ë§ˆì°¬ê°€ì§€ì´ë©° ë§Œì•½ ì¤‘ê°„ì—ì„œ ëˆ„ê°€ ì½”ë“œë¥¼ ìˆ˜ì •í•œë‹¤ë©´ í•´ì‹œê°’ì´ ë³€ê²½ì´ ë˜ì–´ end userê°€ ì½”ë“œë¥¼ ë‹¤ìš´ë°›ê¸° ì „ì— alertë¥¼ ë„ì›Œ ì‚¬ì „ì— ì„¤ì¹˜ë¥¼ ëª» í•˜ë„ë¡ ë§‰ëŠ”ë‹¤. [Picture 4] ì¸ì¦ì„œ ë‹¤ì´ì–´ê·¸ë¨\nSSL Certificate SSL CertificateëŠ” í¬ê²Œ 2ê°€ì§€ ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¥˜í•  ìˆ˜ ìˆë‹¤.\nê²€ì¦íˆë ¤ëŠ” ëŒ€ìƒ ì»¤ë²„í•˜ëŠ” ë„ë©”ì¸ì˜ ê°œìˆ˜ ê²€ì¦í•˜ë ¤ëŠ” ëŒ€ìƒ ê²€ì¦ ëŒ€ìƒì— ë”°ë¼ì„œ ì•”í˜¸í™”í•˜ëŠ” ë°©ì‹ì´ ë‹¬ë¼ì§€ê±°ë‚˜ í•˜ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ ì €ë ´í•˜ê²Œ ë°œê¸‰ë°›ì€ DVì™€ ë¹„ì‹¸ê²Œ ë°œê¸‰ë°›ì€ EVê°€ ê²°êµ­ ë³´ì•ˆì˜ ê´€ì ì—ì„œëŠ” í° ì°¨ì´ê°€ ì—†ë‹¤.\ní•˜ì§€ë§Œ ê²€ì¦ë°›ì€ ëŒ€ìƒì˜ identiyê°€ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— DVëŠ” ì‘ì€ ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ê¸°ê°€ ìš©ì´í•˜ê³  ê·¸ ì™¸ì— e-commerceë‚˜ ì¤‘ìš”í•œ ì •ë³´ë¥¼ ì£¼ê³  ë°›ì•„ì•¼ í•˜ëŠ” ì„œë¹„ìŠ¤ì˜ ê²½ìš°ì—ëŠ” ë‹¤ë¥¸ ì¸ì¦ì„œë¥¼ ì¨ì•¼ í•œë‹¤.\nDomain Validation ë„ë©”ì¸ ì†Œìœ ê¶Œì„ í™•ì¸í•œë‹¤. ì†ì‰½ê²Œ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆë‹¤. (ìµœëŒ€ 1ì¼) ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ” SSL Certificateì˜ í˜•íƒœë‹¤. Letâ€™s encryptì—ì„œ ë°œê¸‰í•˜ëŠ” ì¸ì¦ì„œë„ DVë¡œ, OVë‚˜ EV ì²˜ëŸ¼ ë‹¤ë¥¸ ì¸ì¦ì„ ë°›ì„ ë•ŒëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤. Organization Validation ë„ë©”ì¸ ì†Œìœ ê¶Œ + Organization ì¡´ì¬ë¥¼ í™•ì¸í•œë‹¤. íšŒì‚¬ ê°™ì€ ê²½ìš°, ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ” íšŒì‚¬ì¸ì§€ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ ê´€ë ¨ ì„œë¥˜ë¥¼ ì œì¶œí•˜ê¸°ë„ í•œë‹¤. ë°œê¸‰í•˜ëŠ”ë° ëª‡ ì‹œê°„ ë˜ëŠ” ë©°ì¹  ì •ë„ê°€ ì†Œìš”ëœë‹¤. Extended Validation ë„ë©”ì¸ ì†Œìœ ê¶Œ + Organization ì¡´ì¬ í™•ì¸ + ë¬¼ë¦¬ì ì¸ ì¶”ê°€ ì ˆì°¨ë¥¼ í™•ì¸í•œë‹¤. SSL certification industryâ€™s governing consortium ê°€ì´ë“œë¼ì¸ì„ ì¤€ìˆ˜í•´ì•¼ í•˜ëŠ” ë“± ë°œê¸‰ ì ˆì°¨ê°€ ë³µì¡í•˜ë‹¤. ì»¤ë²„í•˜ëŠ” ë„ë©”ì¸ì˜ ê°œìˆ˜ ì¸ì¦ì„œì—ëŠ” ë„ë©”ì¸ì´ë¼ëŠ” ë§ì´ ìì£¼ ë“±ì¥í•˜ê²Œ ëœë‹¤. í•˜ì§€ë§Œ ë„ë©”ì¸ì´ë¼ëŠ” ë‹¨ì–´ ìì²´ê°€ ëœ»í•˜ëŠ” ì˜ë¯¸ê°€ ëª¨í˜¸í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— í˜¼ì„ ë°©ì§€ ì°¨ì›ì—ì„œ ì¸ì¦ì„œì—ì„œëŠ” FQDN ì´ë¼ëŠ” ë‹¨ì–´ë¥¼ ë” ì„ í˜¸í•œë‹¤.\nFQDNì€ Fully-Qualified Domain Name ì˜ ì•½ìë¡œ ë„ë©”ì¸ ì „ì²´ ì´ë¦„ì„ í‘œê¸°í•˜ëŠ” ë°©ì‹ì„ ëœ»í•œë‹¤.\nFQDN ì˜ˆì‹œ\n# ì•„ë˜ëŠ” ì„œë¡œ ë™ì¼í•œ ë„ë©”ì¸ì´ë‹¤. www.leelee.co.kr leelee.co.kr www.sub.leelee.co.kr # ì•„ë˜ëŠ” ì„œë¡œ ë‹¤ë¥¸ FQDN ì´ë‹¤. www.leelee.co.kr leelee.co.kr Single Domain ë‹¨ í•˜ë‚˜ì˜ FQDNì„ ì»¤ë²„í•œë‹¤. Multiple Domain ì—¬ëŸ¬ê°œì˜ FQDNì„ ì»¤ë²„í•œë‹¤. ì¸ì¦ì„œë¥¼ ë“±ë¡í•  ë•Œ SAN (Subject Alternative Name) í•­ëª©ì— ë‹¤ìˆ˜ì˜ ë„ë©”ì¸ì„ ì…ë ¥í•œë‹¤. Wildcard Domain í•˜ë‚˜ì˜ Root Domainê³¼ ë¬´ì œí•œì˜ ì„œë¸Œë„ë©”ì¸ì„ ì»¤ë²„í•œë‹¤. wildcardëŠ” í•˜ë‚˜ì˜ ì „ì²´ë„ë©”ì¸ì„ ì…ë ¥í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— FQDNì´ë¼ í•˜ì§€ ì•Šì•˜ë‹¤. CA ì—…ì²´ì—ì„œëŠ” ë¹„ìš©ì— ë”°ë¼ì„œ ì»¤ë²„í•˜ëŠ” ì„œë¸Œë„ë©”ì¸ ê°œìˆ˜ì— ì œí•œì„ ë‘ê¸°ë„ í•œë‹¤. * ì„ ì‚¬ìš©í•´ì„œ ë„ë©”ì¸ì„ ì»¤ë²„í•œë‹¤. ì»¤ë²„í•˜ëŠ” ë„ë©”ì¸ ì˜ˆì‹œ\n# Singple Certificate www.leelee.co.kr # Multi-Domain Certificate www.leelee.co.kr leelee.co.kr www.sub.leelee.co.kr # Wildcard Certificate *.leelee.co.kr ì¸ì¦ì„œì™€ ê´€ë ¨ëœ ê°œë… PKI PKIëŠ” Public Key Infrastructure ì˜ ì•½ìë¡œ ê³µê°œí‚¤ ê¸°ë°˜êµ¬ì¡°ë¼ê³  í•˜ë©° ë””ì§€í„¸ ì¸ì¦ì„œë¥¼ ìƒì„±, ê´€ë¦¬, ë°°í¬, ì‚¬ìš©, ì €ì¥ ë° íŒŒê¸°, ê³µê°œí‚¤ ì•”í˜¸í™”ì˜ ê´€ë¦¬ì— í•„ìš”í•œ ì •ì±… ë“±ì„ ëœ»í•œë‹¤. PKIëŠ” ì•„ë˜ì˜ í•­ëª©ì„ ì „ì²´ë¡œ í•˜ê³  ìˆë‹¤.\në¹„ëŒ€ì¹­ í‚¤ ì•Œê³ ë¦¬ì¦˜ì„ ì´ìš©í•œë‹¤. Private key, Public key pair ë¥¼ ìƒì„±í•œë‹¤. Private keyëŠ” ê°œì¸ë§Œ ì†Œìœ í•˜ë©° ë°–ìœ¼ë¡œ ê³µê°œí•´ì„œëŠ” ì•ˆëœë‹¤. Public keyëŠ” ê³µê°œí•˜ëŠ” í‚¤ë¡œ, ëˆ„êµ¬ì—ê²Œë“  ê³µê°œí•´ë„ ëœë‹¤. ë¹„ëŒ€ì¹­ í‚¤ ì•Œê³ ë¦¬ì¦˜ Private key, Public key ë‘ ê°œì˜ í‚¤ë¥¼ ì‚¬ìš©í•œë‹¤. ì´ì²˜ëŸ¼ Encryption(ì•”í˜¸í™”)ì™€ Decryption(ë³µí˜¸í™”)ì— ë‘ ê°œì˜ ë‹¤ë¥¸ í‚¤ë¥¼ ì“°ê¸° ë•Œë¬¸ì— ë¹„ëŒ€ì¹­ í‚¤ë¼ê³  í•œë‹¤. ëŒ€í‘œì ì¸ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œëŠ” RSAê°€ ìˆë‹¤.\nì ìš© ì‹œë‚˜ë¦¬ì˜¤ Public keyë¥¼ ì´ìš©í•´ ì•”í˜¸í™” : ë°ì´í„° ë³´ì•ˆ ì‚¬ìš©ì Bê°€ ì‚¬ì „ì— ê³µìœ ë°›ì€ ì‚¬ìš©ì Aì˜ public keyë¥¼ ì´ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì•”í˜¸í™”í•œë‹¤. ì‚¬ìš©ì Aì˜ public keyë¡œ ì•”í˜¸í™”ëœ ë°ì´í„°ëŠ” ì˜¤ì§ ì‚¬ìš©ì Aì˜ private keyë¡œ ë³µí˜¸í™” í•  ìˆ˜ ìˆë‹¤. ì‚¬ìš©ì Aì˜ private keyëŠ” ì‚¬ìš©ì Aë§Œ ì†Œìœ í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ì‚¬ìš©ì BëŠ” ì‚¬ìš©ì Aë§Œ ë³¼ ìˆ˜ ìˆëŠ” ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê²Œ ëœ ê²ƒì´ë‹¤. [Picture 5] Public keyë¥¼ ì´ìš©í•œ ì•”í˜¸í™”\nPrivate keyë¥¼ ì´ìš©í•´ ì•”í˜¸í™” : ì‹ ì›ì¸ì¦ ì‚¬ìš©ì Aì˜ private keyë¡œ ì•”í˜¸í™” ëœ ë°ì´í„°ëŠ” ì‚¬ìš©ì Aì˜ public keyë¥¼ ì´ìš©í•´ì•¼ë§Œ ë³µí˜¸í™”ë¥¼ í•  ìˆ˜ ìˆë‹¤. ë°ì´í„°ê°€ ì‚¬ìš©ì Aì˜ public keyë¡œ ë³µí˜¸í™”ê°€ ì•ˆëœë‹¤ë©´ ì‚¬ìš©ìAê°€ ë³´ëƒˆë‹¤ëŠ” ê²ƒì„ ì¸ì¦í•  ìˆ˜ ì—†ë‹¤. ì‚¬ìš©ì Aì˜ public keyë¡œ ë°ì´í„°ë¥¼ ë³µí˜¸í™”í•  ìˆ˜ ìˆë‹¤ë©´ ì‚¬ìš©ì Aê°€ ë³´ëƒˆë‹¤ëŠ” ê²ƒì„ ì¸ì¦í•  ìˆ˜ ìˆë‹¤. [Picture 6] Private keyë¥¼ ì´ìš©í•œ ì•”í˜¸í™”\ní•´ì»¤ê°€ ì•”í˜¸í™”ëœ ë°ì´í„°ë¥¼ ë„ì²­í•  ê²½ìš° ì‚¬ìš©ì Aì˜ private keyê°€ ì—†ê¸° ë•Œë¬¸ì— í•´ì»¤ê°€ ì¤‘ê°„ì—ì„œ ë°ì´í„°ë¥¼ ë³µí˜¸í™”ã…Ší•  ìˆ˜ ì—†ë‹¤. [Picture 7] í•´í‚¹ ì‹œë„\nPKIì—ì„œ ê°€ëŠ¥í•œ ë‘ ê°€ì§€ ë°©ì‹ì˜ ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ public keyë¥¼ ì´ìš©í•´ ì•”í˜¸í™” í•˜ë©´ ì›í•˜ëŠ” ìƒëŒ€ë°©ì—ê²Œë§Œ ë°ì´í„°ë¥¼ ê³µê°œí•  ìˆ˜ ìˆë‹¤. from ì‚¬ìš©ì B â†’ to ì‚¬ìš©ì A private keyë¥¼ ì´ìš©í•´ ì•”í˜¸í™” í•˜ë©´ ì‹ ì› ì¸ì¦ì„ í•  ìˆ˜ ìˆë‹¤. from ì‚¬ìš©ì A â†’ to ì‚¬ìš©ì B X.509 X.509ëŠ” ë””ì§€í„¸ ì¸ì¦ì„œ ìƒì„± ê´€ë ¨ êµ­ì œ í‘œì¤€ì„(format)ì„ ì˜ë¯¸í•œë‹¤. X.509ë¥¼ ì‚¬ìš©í•˜ëŠ” ë„¤íŠ¸ì›Œí¬ ë…¸ë“œë“¤ì€ ì „ì„¸ê³„ì ìœ¼ë¡œ ì•½ì†ëœ x.509 êµ­ì œ í‘œì¤€ì„ ë°©ì‹ìœ¼ë¡œ ë””ì§€í„¸ IDë¥¼ ìƒì„±í•´ ì„œë¡œì˜ ì‹ ì›ì„ ì¦ëª…í•  ìˆ˜ ìˆë‹¤.\nX.509ëŠ” ì¸í„°ë„·ì˜ ë‹¤ì–‘í•œ ë¶„ì•¼ì—ì„œ ì‹ ì› í™•ì¸ì„ ìœ„í•´ ê´‘ë²”ìœ„í•˜ê²Œ ì‚¬ìš©ë˜ê³  ìˆëŠ” ê°€ì¥ ìœ ëª…í•œ ë””ì§€í„¸ ì‹ ì› ì¦ëª… ë°©ì‹ì´ë‹¤.\nX.509 version 3 ì¸ì¦ì„œ ì–‘ì‹ [Picture 8] X.509 ì¸ì¦ì„œ ì–‘ì‹\nKey usage extension ì¸ì¦ì„œì— í¬í•¨ë˜ì–´ìˆëŠ” public keyì˜ ëª©ì ì„ ë‚˜íƒ€ë‚¸ë‹¤. Key usage extensionì„ ì„¤ì •í•´ public keyì˜ ì‚¬ìš©ì²˜ë¥¼ ì œí•œí•  ìˆ˜ ìˆë‹¤.\nKey usage extension ì˜ˆì‹œ\nì¸ì¦ì„œê°€ ì„œëª…ì„ í•˜ê±°ë‚˜ signatureë¥¼ ê²€ì¦í•˜ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤ë©´ Key usage extensionìœ¼ë¡œ Digital signatureì™€ Non-repudication ë¥¼ ì„¤ì •í•œë‹¤. ì¸ì¦ì„œê°€ key ê´€ë¦¬ë¥¼ ìœ„í•´ì„œë§Œ ì‚¬ìš©ì´ ëœë‹¤ë©´ key enciphermentë¥¼ ì„¤ì •í•œë‹¤. [Picture 9] Key usage extension ì¢…ë¥˜\nExtended key usage Key usage extensionì´ ê¸°ë³¸ì ì¸ ì¸ì¦ì„œì˜ ì‚¬ìš© ëª©ì (purpose)ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê²ƒì´ë¼ë©´ Extended key usageëŠ” ì¸ì¦ì„œì˜ additionalí•œ ì‚¬ìš© ëª©ì ì„ ë‚˜íƒ€ë‚¸ë‹¤. ë³´í†µ Extended key usageëŠ” end entityì˜ ì¸ì¦ì„œì—ë§Œ í‘œì‹œê°€ ëœë‹¤.\nExtended key usage ì˜ˆì‹œ\ncriticalì´ë¼ë©´ ì¸ì¦ì„œëŠ” ì„¤ì •ë˜ì–´ìˆëŠ” ìš©ë„ë¡œë§Œ ì‚¬ìš©ì„ í•´ì•¼ í•œë‹¤. í•´ë‹¹ ì¸ì¦ì„œë¥¼ ë‹¤ë¥¸ ìš©ë„ë¡œ ì‚¬ìš© í–ˆì„ ê²½ìš°ì—ëŠ” CA ì •ì±…ì— ìœ„ë°˜ëœë‹¤. non-critical ì´ë¼ë©´ ì„¤ì •ë˜ì–´ìˆëŠ” ìš©ë„ ì™¸ì˜ ë‹¤ë¥¸ ìš©ë„ë¡œ ì‚¬ìš© í–ˆì„ ê²½ìš°ì—ë„ CAì˜ ì œí•œì— ê±¸ë¦¬ì§€ ì•ŠëŠ”ë‹¤. ë˜í•œ ë‹¤ìˆ˜ì˜ kye/certificateì„ ê°€ì§€ê³  ìˆëŠ” entityë¼ë©´ ë§ëŠ” key/certificateë¥¼ ì°¾ëŠ”ë°ì—ë„ ì‚¬ìš©ì´ ë  ìˆ˜ ìˆë‹¤. [Picture 10] Extend key usage extension ì¢…ë¥˜\nCSR Certificate Signing Requestì˜ ì•½ìì´ë‹¤. CAì— ì¸ì¦ì„œë¥¼ ì„œëª…í•´ë‹¬ë¼ê³  ìš”ì²­í•  ë•Œ ì‚¬ìš©ì´ ëœë‹¤. ì¸ì¦ì„œ ë°œê¸‰í•  ë•Œë§Œ ì‚¬ìš©ì´ ë˜ê³ , ì¸ì¦ì„œê°€ ë°œê¸‰ëœ í›„ì—ëŠ” ë³„ë„ë¡œ ì‚¬ìš© ë˜ì§€ ì•ŠëŠ”ë‹¤. Private Key PKIì˜ í•µì‹¬ì´ ë˜ëŠ” ë¹„ë°€í‚¤ì´ë‹¤. ë§Œë£Œ ê¸°ê°„ì´ ë³„ë„ë¡œ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤. Public Key PKIì˜ ë˜ ë‹¤ë¥¸ í•µì‹¬ì´ ë˜ëŠ” ê³µê°œí‚¤ì´ë‹¤. Public Keyë¼ê³  ë”°ë¡œ íŒŒì¼ì´ ì¡´ì¬í•˜ê¸° ë³´ë‹¤ëŠ” Certificateì— í¬í•¨ì´ ë˜ì–´ìˆë‹¤. ë•Œë¬¸ì— public keyì™€ certificateì„ í˜¼ìš©í•´ì„œ ì“´ë‹¤. ë§Œë£Œ ê¸°ê°„ì´ ë³„ë„ë¡œ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤. Certificate public keyì™€ ê°ì¢… ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” ì¸ì¦ì„œë¡œ, x.509 í˜•ì‹ìœ¼ë¡œ ë˜ì–´ìˆë‹¤. ë§Œë£Œ ê¸°ê°„ì´ ì¡´ì¬í•œë‹¤. ë•Œë¬¸ì— ì¸ì¦ì„œê°€ ë§Œë£Œë˜ë©´ ìƒˆë¡œìš´ ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ì•„ì•¼ í•œë‹¤. PKI File Extension PEM (Privacy Enhanced Mail) í˜•ì‹ ì€ ê°€ì¥ í”í•˜ê²Œ ì‚¬ìš©ë˜ëŠ” X.509 ì¸ì¦ì„œ í˜•ì‹ì¸ë° .crt, .pem, .cer, .key í™•ì¥ì ëª¨ë‘ê°€ PEM í˜•ì‹ì´ë‹¤. \u0026mdash;\u0026ndash;BEGIN CERTIFICATE\u0026mdash;\u0026ndash; ë¡œ ì‹œì‘í•œë‹¤.\n.cert *.crt Certificateë¥¼ ìœ„í•œ í™•ì¥ìë‹¤. Base64 encoded X.509 certificate DER encoded X.509 certificate í•´ë‹¹ í™•ì¥ìë“¤ì€ Private keyë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤. .key Private key í™•ì¥ì¥ë‹¤. .pem Certificateë¥¼ ìœ„í•œ í™•ì¥ìë‹¤. .crl Certificate Revoke Listë¥¼ ìœ„í•œ í™•ì¥ìë‹¤. Certificate Revoke ListëŠ” íê¸°ëœ ì¸ì¦ì„œì˜ ëª©ë¡ì´ë©°, CAëŠ” CRLì„ í†µí•´ íê¸°ëœ ì¸ì¦ì„œë¥¼ ê´€ë¦¬í•œë‹¤. .csr Certificate Singing Requestë¥¼ ìœ„í•œ í™•ì¥ìë‹¤. .der Certificateì„ ìœ„í•œ ì¸ì¦ì„œ í™•ì¥ìì¸ë°, DER encoded X.509 Certificateì— í•œì •ëœë‹¤. í•´ë‹¹ í™•ì¥ìëŠ” Private keyë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤. ë³´í†µì˜ ì¸ì¦ì„œë“¤ê³¼ ë‹¬ë¦¬ ----BEGIN CERTIFICATE----- ë¡œ ì‹œì‘í•˜ì§€ ì•ŠëŠ”ë‹¤. Java contextsì—ì„œ ìì£¼ ì‚¬ìš©ì´ ëœë‹¤. .der ì¸ì¦ì„œ ì˜ˆì‹œ\n3082 07fd 3082 05e5 a003 0201 0202 1068 1604 dff3 34f1 71d8 0a73 5599 c141 7230 0d06 092a 8648 86f7 0d01 010b 0500 3072 310b 3009 0603 5504 0613 0255 5331 0e30 0c06 0355 0408 0c05 5465 7861 7331 1030 0e06 0355 0407 0c07 486f 7573 746f 6e31 1130 0f06 0355 040a 0c08 5353 4c20 436f 7270 312e 302c 0603 5504 030c 2553 534c 2e63 6f6d 2045 5620 5353 4c20 496e 7465 726d 6564 6961 7465 2043 4120 5253 4120 ","date":"2022-06-15","permalink":"https://leeleelee3264.github.io/post/2022-06-15-digital-certificate-part-one/","tags":["Infra"],"title":"Digital certificate"}]